package ru.groupprofi.crmprofi.dialer.domain

/**
 * Утилита для нормализации номеров телефонов.
 * Убирает пробелы, дефисы, скобки и плюсы для единообразного сравнения.
 */
object PhoneNumberNormalizer {
    
    /**
     * Нормализовать номер телефона.
     * Убирает все пробелы, дефисы, скобки и плюсы.
     * Заменяет "8" в начале на "7" для российских номеров (11 цифр).
     * 
     * Примеры:
     * - "+7 (999) 111-22-33" → "79991112233"
     * - "8 999 111 22 33" → "79991112233" (8 заменяется на 7)
     * - "+8 999 111 22 33" → "79991112233" (8 заменяется на 7)
     * - "9991112233" → "9991112233" (короткий номер, не меняем)
     * 
     * @param phone исходный номер телефона
     * @return нормализованный номер (только цифры)
     */
    fun normalize(phone: String): String {
        var normalized = phone.replace(" ", "")
            .replace("-", "")
            .replace("(", "")
            .replace(")", "")
            .replace("+", "")
        
        // Если номер начинается с 8 и имеет длину российского номера (11 цифр), заменяем 8 на 7
        if (normalized.startsWith("8") && normalized.length == 11) {
            normalized = "7" + normalized.substring(1)
        }
        
        return normalized
    }
    
    /**
     * Маскировать номер телефона для логов (скрывает средние цифры).
     * 
     * Примеры:
     * - "79991112233" → "799***2233"
     * - "123" → "***"
     * 
     * @param phone номер телефона
     * @return замаскированный номер
     */
    fun maskPhone(phone: String): String {
        if (phone.length <= 4) return "***"
        return "${phone.take(3)}***${phone.takeLast(4)}"
    }
}
