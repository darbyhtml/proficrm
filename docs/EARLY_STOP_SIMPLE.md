# Простое объяснение раннего прерывания пагинации

## Главное правило: **НИЧЕГО НЕ ПРОПУСТИМ**

Логика раннего прерывания работает так, чтобы **не пропустить ни одного контакта**, который нужен.

## Как это работает (простыми словами)

### Ситуация 1: У всех компаний есть контакты
- **50 компаний**, у всех есть контакты
- Получили **250 контактов** (1 страница)
- Нашли контакты для **50/50 компаний** (100%)
- **Результат**: ✅ Прервется, т.к. нашли для всех

### Ситуация 2: Не у всех компаний есть контакты (РЕАЛЬНЫЙ СЛУЧАЙ)
- **50 компаний**, но контакты есть только у **3 компаний**
- Получили **250 контактов** (1 страница)
- Нашли контакты для **3/50 компаний** (6%)
- **Результат**: ❌ НЕ прервется, т.к. не знаем, есть ли контакты у остальных 47 компаний
- Продолжит получать контакты, пока не получит все 25000

### Ситуация 3: Слишком много нерелевантных контактов (НОВОЕ)
- **50 компаний**, контакты есть только у **3 компаний**
- Получили **5000 контактов** (20 страниц)
- Нашли **9 релевантных контактов** из 5000 (0.18%)
- **Результат**: ✅ Прервется, т.к. релевантность < 10%
- **Почему безопасно**: Если после 5000 контактов релевантность < 10%, значит API возвращает все контакты, а не только для наших компаний. Дальше будет только хуже.

## Важно понимать

### ❌ НЕ прерывается, если:
- Найдены контакты для **части** компаний (например, 3/50)
- Получено **мало** контактов (< 5000)
- Релевантность **высокая** (> 10%)

### ✅ Прерывается, если:
1. Найдены контакты для **ВСЕХ** компаний (100%) - значит, все контакты уже получены
2. Получено **много** контактов (2000+) И найдено для **большинства** (80%+) - значит, нашли почти все
3. Получено **очень много** контактов (5000+) И релевантность **низкая** (< 10%) - значит, API возвращает все контакты, дальше будет только хуже

## Гарантии

✅ **Гарантия 1**: Если у компании есть контакты, они будут найдены
- Логика не прерывается, пока не получит достаточно контактов (минимум 5000)
- Если релевантность высокая (> 10%), продолжит получать контакты

✅ **Гарантия 2**: Не будет получать лишние контакты без необходимости
- Если релевантность низкая (< 10%) после 5000 контактов, прервется
- Это означает, что API возвращает все контакты, а не только для наших компаний

## Пример из ваших логов

- **50 компаний**
- Получено: **25000 контактов**
- Найдено: **9 контактов** для **3 компаний**
- Релевантность: **0.036%** (< 10%)

**С новой логикой**:
- После **5000 контактов**: релевантность 0.036% < 10% → ✅ **Прервется**
- Время: **~20 секунд** вместо **~2 минут**

**Безопасность**: Все 9 контактов будут найдены в первых 5000 контактах, дальше получать не нужно.
