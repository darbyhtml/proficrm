# Улучшение UX карточки компании: два режима просмотра

## Что сделано

### Часть A: Откат изменений списка компаний
- Полностью откачены все изменения, связанные со списком компаний (view_mode, compact вид)
- Список компаний `/companies/` возвращен к исходному состоянию
- Удалены все связанные endpoint'ы, шаблоны и миграции

### Часть B: Новый дизайн карточки компании
- Реализован современный режим просмотра карточки компании
- Добавлен переключатель режимов (иконки) в шапку
- Поддержка двух режимов: Classic (старый) и Modern (новый)

## Как тестировать

### 1. Проверка отката списка компаний
- Откройте `/companies/`
- Убедитесь, что нет переключателя "Обычный/Компактный"
- Убедитесь, что список отображается как раньше (таблица)
- Проверьте, что фильтры, пагинация, массовые операции работают

### 2. Проверка карточки компании - Classic режим
- Откройте любую карточку компании `/companies/<uuid>/`
- По умолчанию должен быть Classic режим (старый layout)
- В правом верхнем углу должны быть две иконки-переключателя
- Классический режим должен выглядеть как раньше

### 3. Проверка переключения режимов
- Нажмите на иконку "Modern" (вторая иконка)
- Режим должен переключиться мгновенно без перезагрузки страницы
- Нажмите на иконку "Classic" (первая иконка)
- Режим должен вернуться к классическому виду

### 4. Проверка Modern режима
- Переключитесь на Modern режим
- Проверьте:
  - Sticky header с названием компании, статусами
  - Заметка (pinned или последняя) видна сразу в левой колонке
  - Ближайшие задачи (2-3) видны сразу
  - Контакты и ключевые сведения в правой колонке
  - Кнопка "Развернуть" для длинных заметок работает
  - Details "Все заметки" и "Все задачи" разворачиваются

### 5. Проверка сохранения выбора
- Переключитесь на Modern режим
- Обновите страницу (F5)
- Режим должен остаться Modern
- Выйдите и зайдите снова - режим должен сохраниться

### 6. Проверка функциональности в Modern режиме
- Добавление заметки через форму в секции "Все заметки"
- Редактирование/удаление заметок
- Закрепление/открепление заметок
- Просмотр задач
- Все модальные окна (удаление компании и т.д.)

### 7. Проверка производительности
- Откройте карточку компании с заметками и задачами
- В DevTools Network проверьте количество запросов
- Не должно быть N+1 запросов для заметок/задач/контактов

## Технические детали

### Миграции
- `0007_remove_uiuserpreference_company_list_view_mode.py` - удаление поля списка
- `0008_uiuserpreference_company_detail_view_mode.py` - добавление поля карточки

### Endpoints
- `POST /preferences/ui/company-detail-view-mode/` - сохранение режима карточки

### Модель
- `UiUserPreference.company_detail_view_mode` - поле для хранения выбора (classic/modern, default: classic)

### Шаблоны
- `company_detail.html` - обновлен с поддержкой двух режимов
- `company_list.html` - откачен к исходному состоянию
- `company_list_rows.html` - откачен к исходному состоянию
