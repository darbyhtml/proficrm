# –û—Ç—á—ë—Ç: Enterprise Final Compliance Pass

–§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ –¥–ª—è –¥–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –¥–æ enterprise-compliance —É—Ä–æ–≤–Ω—è.

## 1. –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### (1) PII-Safe Logging Policy ‚úÖ

**–§–∞–π–ª—ã:**
- `backend/mailer/logging_utils.py` (–Ω–æ–≤—ã–π)
- `backend/mailer/tasks.py`
- `backend/crm/settings.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `logging_utils.py` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
  - `mask_email()` ‚Äî –º–∞—Å–∫–∏—Ä—É–µ—Ç email (jo***@company.com)
  - `email_domain()` ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–æ–º–µ–Ω
  - `email_hash()` ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ö—ç—à email
  - `safe_email_for_logging()` / `get_pii_log_fields()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è extra={}
- –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º:
  - **INFO**: —Ç–æ–ª—å–∫–æ `email_domain`, `email_masked`, `email_hash` (–ù–ï –ø–æ–ª–Ω—ã–π email)
  - **WARNING/ERROR**: —Ç–æ–ª—å–∫–æ `email_masked` + `email_domain` (–ù–ï –ø–æ–ª–Ω—ã–π email)
  - **DEBUG**: –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –ø–æ–ª–Ω—ã–π email –¢–û–õ–¨–ö–û –µ—Å–ª–∏ `MAILER_LOG_FULL_EMAILS=True`
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `settings.py`:
  - `MAILER_LOG_PII_LEVEL` (default: "ERROR")
  - `MAILER_LOG_FULL_EMAILS` (default: False)
  - `MAILER_LOG_HASH_SALT` (default: "default-salt-change-in-production")
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –º–µ—Å—Ç–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
  - "Email sent successfully" ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PII-safe –ø–æ–ª—è
  - "Failed to send email" ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç masked email
  - "Test email sent successfully" ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PII-safe –ø–æ–ª—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í INFO –ª–æ–≥–∞—Ö –Ω–µ—Ç –ø–æ–ª–Ω–æ–≥–æ email –≤–æ–æ–±—â–µ
- –í ERROR/WARN –ª–æ–≥–∞—Ö —Ç–æ–ª—å–∫–æ masked/hashed email
- DEBUG –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –ø–æ–ª–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º —Ñ–ª–∞–≥–µ

### (2) Structured Output (JSON Formatter) ‚úÖ

**–§–∞–π–ª—ã:**
- `backend/crm/json_formatter.py` (–Ω–æ–≤—ã–π)
- `backend/crm/settings.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –°–æ–∑–¥–∞–Ω `JSONFormatter` –¥–ª—è structured logging
- –§–æ—Ä–º–∞—Ç: `{"level": "...", "logger": "...", "message": "...", "timestamp": "...", ...extra_fields}`
- –ü–æ–¥–∫–ª—é—á—ë–Ω –≤ `settings.LOGGING`:
  - –í production (`DEBUG=False`): console handler –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON formatter
  - –í development (`DEBUG=True`): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è verbose formatter
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ `extra={}` –ø–æ–ª—è –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ª–æ–≥-–≤—ã–≤–æ–¥

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Structured fields (campaign_id, queue_id, defer_reason, ...) –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö
- –õ–æ–≥–∏ –≥–æ—Ç–æ–≤—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ELK/Grafana Loki
- –í development –æ—Å—Ç–∞—ë—Ç—Å—è —á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### (3) Fail-Open / Fail-Closed Policy ‚úÖ

**–§–∞–π–ª—ã:**
- `backend/mailer/services/rate_limiter.py`
- `backend/mailer/throttle.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**

**A) Rate limiter (SMTP 100/—á–∞—Å): FAIL-OPEN**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ Redis: —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É (availability-first)
- –õ–æ–≥–∏—Ä—É–µ—Ç ERROR —Å –ø–æ–ª–µ–º `policy="fail_open"` –¥–ª—è alerting
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–¥–µ —è–≤–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É

**B) Abuse throttling (API endpoints): FAIL-CLOSED**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ Redis: –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å (`throttled=True`, `reason="throttle_backend_unavailable"`)
- UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–¥–µ —è–≤–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É (security-first)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ Redis down –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –∏ —Ä–∞–∑–Ω–æ–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º
- Rate limiter: availability-first (–ª—É—á—à–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å, —á–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å)
- Throttling: security-first (–ª—É—á—à–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, —á–µ–º —Ä–∞–∑—Ä–µ—à–∏—Ç—å DoS)

### (4) Configurability of Limits ‚úÖ

**–§–∞–π–ª—ã:**
- `backend/crm/settings.py`
- `backend/mailer/constants.py`
- `backend/mailer/tasks.py`
- `backend/mailer/views.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –í—Å–µ –ª–∏–º–∏—Ç—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Django settings/env:
  - `MAILER_MAX_CAMPAIGN_RECIPIENTS` (default: 10000)
  - `MAILER_THROTTLE_CAMPAIGN_START_PER_HOUR` (default: 10)
  - `MAILER_THROTTLE_TEST_EMAIL_PER_HOUR` (default: 5)
  - `MAILER_CIRCUIT_BREAKER_THRESHOLD` (default: 10)
  - `MAILER_TRANSIENT_RETRY_DELAY_MINUTES` (default: 5)
- –í—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ `getattr(settings, "...", default)`
- Playbook –æ–±–Ω–æ–≤–ª—ë–Ω: —Ä–∞–∑–¥–µ–ª "–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –õ–∏–º–∏—Ç—ã –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ (—á–µ—Ä–µ–∑ .env –∏–ª–∏ settings)
- Playbook —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é –ª–∏–º–∏—Ç–æ–≤

### (5) Playbook Verification ‚úÖ

**–§–∞–π–ª:** `MAILER_ONCALL_PLAYBOOK.md`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã SQL-–∑–∞–ø—Ä–æ—Å—ã:
  - –ó–∞–º–µ–Ω—ë–Ω Django ORM —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `campaign__created_by_id` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SQL JOIN
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è (`consecutive_transient_errors`)
- –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "Schema Assumptions":
  - –û–ø–∏—Å–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏ —Å–≤—è–∑–µ–π
  - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã—Ö –ª–∏–º–∏—Ç–∞—Ö
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–æ–π –ë–î
- –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- Playbook —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω (—Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é)

### (6) Minimal Observability Pack ‚úÖ

**–§–∞–π–ª:** `MAILER_OBSERVABILITY_PACK.md`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π observability pack:
  - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –∏ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π
  - –ì–æ—Ç–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã/–ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (ELK/Grafana Loki/grep)
  - –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∞–ª—ë—Ä—Ç—ã (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–µ)
  - SLO-like –º–µ—Ç—Ä–∏–∫–∏ (3 –æ—Å–Ω–æ–≤–Ω—ã—Ö + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
  - –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ, –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ, –ø—Ä–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–µ)
  - –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  - –ü—Ä–∏–º–µ—Ä—ã –¥–∞—à–±–æ—Ä–¥–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ì–æ—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –ª–æ–≥–∞—Ö
- –ß—ë—Ç–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è SLO

## 2. –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
1. `backend/mailer/logging_utils.py` ‚Äî PII-safe logging utilities
2. `backend/crm/json_formatter.py` ‚Äî JSON formatter –¥–ª—è structured logging
3. `MAILER_OBSERVABILITY_PACK.md` ‚Äî observability pack
4. `MAILER_ENTERPRISE_FINAL_REPORT.md` ‚Äî —ç—Ç–æ—Ç –æ—Ç—á—ë—Ç

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `backend/crm/settings.py`:
   - –î–æ–±–∞–≤–ª–µ–Ω JSON formatter –≤ LOGGING
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã (MAILER_*)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PII logging (MAILER_LOG_*)
2. `backend/mailer/constants.py`:
   - –§—É–Ω–∫—Ü–∏—è `get_max_campaign_recipients()` –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∑ settings
3. `backend/mailer/tasks.py`:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PII-safe logging –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã—Ö –ª–∏–º–∏—Ç–æ–≤ (circuit breaker, retry delay)
   - –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ `consecutive_transient_errors` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ
4. `backend/mailer/throttle.py`:
   - FAIL-CLOSED –ø–æ–ª–∏—Ç–∏–∫–∞ –ø—Ä–∏ Redis error
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 3 –∑–Ω–∞—á–µ–Ω–∏—è: `(is_throttled, count, reason)`
5. `backend/mailer/views.py`:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã—Ö –ª–∏–º–∏—Ç–æ–≤
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ `throttle_reason` –¥–ª—è –ø–æ–Ω—è—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
6. `backend/mailer/services/rate_limiter.py`:
   - –Ø–≤–Ω–∞—è FAIL-OPEN –ø–æ–ª–∏—Ç–∏–∫–∞ —Å structured logging
7. `backend/mailer/tests.py`:
   - –¢–µ—Å—Ç—ã –¥–ª—è PII policy
   - –¢–µ—Å—Ç—ã –¥–ª—è fail-open/closed –ø–æ–ª–∏—Ç–∏–∫–∏
   - –¢–µ—Å—Ç—ã –¥–ª—è settings overrides
8. `MAILER_ONCALL_PLAYBOOK.md`:
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã SQL-–∑–∞–ø—Ä–æ—Å—ã
   - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "Schema Assumptions"
   - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã"

## 3. –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä—É–∫–∞–º–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ PII-safe logging:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   ```bash
   docker logs celery_worker --tail 100 | grep "Email sent successfully"
   ```
3. –í –ª–æ–≥–∞—Ö –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–Ω–æ–≥–æ email –≤ INFO
4. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—è: `email_domain`, `email_masked`, `email_hash`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ JSON formatter:
1. –í production (`DEBUG=False`): –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–¥–∏–Ω –ª–æ–≥:
   ```bash
   docker logs celery_worker --tail 1 | python -m json.tool
   ```
3. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π JSON —Å –ø–æ–ª—è–º–∏ –∏–∑ `extra={}`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ fail-closed (throttling):
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis: `docker stop redis`
2. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
3. –î–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—à–∏–±–∫–∞: "–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å Redis: `docker start redis`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ fail-open (rate limiter):
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis: `docker stop redis`
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
3. –†–∞—Å—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å—Å—è (fail-open)
4. –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ERROR: "Error reserving rate limit token (Redis unavailable)"
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å Redis: `docker start redis`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã—Ö –ª–∏–º–∏—Ç–æ–≤:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ `.env`: `MAILER_MAX_CAMPAIGN_RECIPIENTS=5000`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Django/Celery
3. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é —Å >5000 –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º–∏
4. –î–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—à–∏–±–∫–∞ —Å –ª–∏–º–∏—Ç–æ–º 5000

### –ü—Ä–æ–≤–µ—Ä–∫–∞ playbook SQL:
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ë—ã—Å—Ç—Ä—ã–π –¥–∏–∞–≥–Ω–æ–∑"
2. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

## 4. –ü–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ª–æ–≥–æ–≤

**PII (Personally Identifiable Information) –≤ –ª–æ–≥–∞—Ö –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π:**

- **INFO —É—Ä–æ–≤–µ–Ω—å:** –ü–æ–ª–Ω—ã–π email –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –Ω–∏–∫–æ–≥–¥–∞. –†–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ: –¥–æ–º–µ–Ω, –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π email (jo***@company.com), —Ö—ç—à.
- **WARNING/ERROR —É—Ä–æ–≤–µ–Ω—å:** –ü–æ–ª–Ω—ã–π email –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è. –†–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ: –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π email + –¥–æ–º–µ–Ω.
- **DEBUG —É—Ä–æ–≤–µ–Ω—å:** –ü–æ–ª–Ω—ã–π email –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∫–ª—é—á—ë–Ω –¢–û–õ–¨–ö–û –µ—Å–ª–∏ `MAILER_LOG_FULL_EMAILS=True` (—Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `MAILER_LOG_PII_LEVEL` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è PII (default: "ERROR")
- `MAILER_LOG_FULL_EMAILS` ‚Äî —Ä–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–ª–Ω—ã–π email –≤ DEBUG (default: False)
- `MAILER_LOG_HASH_SALT` ‚Äî —Å–æ–ª—å –¥–ª—è —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∞ –≤ production)

**‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô CHECKLIST –î–õ–Ø PRODUCTION DEPLOYMENT:**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `MAILER_LOG_HASH_SALT` —á–µ—Ä–µ–∑ environment variable (–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π "default-salt-change-in-production")
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `MAILER_LOG_FULL_EMAILS=False` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `MAILER_LOG_PII_LEVEL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ "ERROR" –∏–ª–∏ –≤—ã—à–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏—Å—Ç–µ–º–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º GDPR –∏ enterprise-–ø–æ–ª–∏—Ç–∏–∫–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö. Email –∞–¥—Ä–µ—Å–∞ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ production –ª–æ–≥–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.

## 5. üî• –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï –î–õ–Ø –ê–†–•–ò–¢–ï–ö–¢–û–†–ê

–ü–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å —Ä–∞—Å—Å—ã–ª–æ–∫ –¥–æ–≤–µ–¥—ë–Ω –¥–æ enterprise-compliance —É—Ä–æ–≤–Ω—è. –ó–∞–∫—Ä—ã—Ç—ã –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –≤–æ–ø—Ä–æ—Å—ã: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ PII-safe logging –ø–æ–ª–∏—Ç–∏–∫–∞ (email –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ INFO/WARNING/ERROR), –¥–æ–±–∞–≤–ª–µ–Ω JSON formatter –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ structured output, —è–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã fail-open/closed –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º (rate limiter ‚Äî availability-first, throttling ‚Äî security-first), –≤—Å–µ –ª–∏–º–∏—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã —á–µ—Ä–µ–∑ settings/env, playbook SQL –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, —Å–æ–∑–¥–∞–Ω observability pack —Å –≥–æ—Ç–æ–≤—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç enterprise-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (PII –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–≥–∏), –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å (—è–≤–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã), –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å (–ª–∏–º–∏—Ç—ã –º–µ–Ω—è—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞), observability (structured logs –≥–æ—Ç–æ–≤—ã –¥–ª—è ELK/Loki, –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–ª—ë—Ä—Ç—ã). –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª—ë—Ä—Ç—ã –∏–∑ observability pack, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å structured logs –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–æ–ª–≥–æ–π —Å–ø–æ–∫–æ–π–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –Ω–∞ enterprise-—É—Ä–æ–≤–Ω–µ.
