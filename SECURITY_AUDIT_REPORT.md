# Security Audit & Production Readiness Report
**–î–∞—Ç–∞:** 2025-01-29  
**–ü—Ä–æ–µ–∫—Ç:** CRM –ü–†–û–§–ò  
**–ê—É–¥–∏—Ç–æ—Ä:** AI Security Review

---

## –≠–¢–ê–ü 0: –ö–ê–†–¢–ê –ü–†–û–ï–ö–¢–ê

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Backend:** Django 6.0, Python 3.13
- **Database:** PostgreSQL 16 (production), SQLite (dev)
- **Cache/Queue:** Redis 7, Celery 5.4
- **API:** Django REST Framework + JWT (simplejwt)
- **Frontend:** Django Templates + TailwindCSS (CDN)
- **Deployment:** Docker Compose, Nginx (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ)
- **Mobile:** Android (Kotlin) ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
**–°—Ç–∏–ª—å:** –ú–æ–Ω–æ–ª–∏—Ç–Ω–æ–µ Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:**
1. **accounts/** ‚Äî –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ä–æ–ª–∏ (RBAC)
2. **companies/** ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏—è–º–∏, –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏, –∑–∞–º–µ—Ç–∫–∞–º–∏
3. **tasksapp/** ‚Äî –ó–∞–¥–∞—á–∏, —Ç–∏–ø—ã –∑–∞–¥–∞—á
4. **mailer/** ‚Äî Email –∫–∞–º–ø–∞–Ω–∏–∏, SMTP –∞–∫–∫–∞—É–Ω—Ç—ã, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (Fernet)
5. **phonebridge/** ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∏–µ–π (Android)
6. **amocrm/** ‚Äî –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ amoCRM API
7. **ui/** ‚Äî UI –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, —Ñ–æ—Ä–º—ã, —à–∞–±–ª–æ–Ω—ã
8. **audit/** ‚Äî –ê—É–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
9. **notifications/** ‚Äî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞
- **Web UI:** `/` ‚Üí `ui.urls` ‚Üí session auth
- **REST API:** `/api/` ‚Üí DRF routers ‚Üí JWT auth
- **Admin:** `/admin/` ‚Üí Django admin (—Ç–æ–ª—å–∫–æ ADMIN —Ä–æ–ª—å)
- **Phone API:** `/api/phone/*` ‚Üí JWT auth
- **Health:** `/health/` ‚Üí –ø—É–±–ª–∏—á–Ω—ã–π
- **Security:** `/.well-known/security.txt` ‚Üí –ø—É–±–ª–∏—á–Ω—ã–π

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **Environment:** `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (Docker) –∏–ª–∏ `backend/.env` (–ª–æ–∫–∞–ª—å–Ω–æ)
- **Settings:** `backend/crm/settings.py` ‚Äî —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ DEBUG/production
- **Secrets:** `DJANGO_SECRET_KEY`, `MAILER_FERNET_KEY`, `POSTGRES_PASSWORD` ‚Äî —á–µ—Ä–µ–∑ env
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:** `backend/*/migrations/` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Django –º–∏–≥—Ä–∞—Ü–∏–∏

### –ó–∞–ø—É—Å–∫
```bash
# Docker Compose (production)
docker-compose -f docker-compose.yml -f docker-compose.vds.yml up -d

# Services:
# - web: Django runserver (–ø–æ—Ä—Ç 8000)
# - celery: Celery worker
# - celery-beat: Celery scheduler
# - db: PostgreSQL
# - redis: Cache + Celery broker
```

---

## –≠–¢–ê–ü 1: –ò–ù–í–ï–ù–¢–ê–†–ò–ó–ê–¶–ò–Ø –†–ò–°–ö–û–í

### A) SECURITY

#### A1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏
- ‚úÖ `.env` –≤ `.gitignore`
- ‚ö†Ô∏è **P1:** `env.example` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä—ã –ø–∞—Ä–æ–ª–µ–π (`POSTGRES_PASSWORD=crm`) ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –ª—É—á—à–µ —É–±—Ä–∞—Ç—å
- ‚ö†Ô∏è **P1:** `SECRET_KEY` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"dev-secret-key-change-me"` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å—Ç—å –≤ settings, –Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `DEBUG=0`
- ‚ö†Ô∏è **P0:** `MAILER_FERNET_KEY` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º (`os.getenv("MAILER_FERNET_KEY", "")`) ‚Äî –µ—Å–ª–∏ –ø—É—Å—Ç–æ–π, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `SECRET_KEY` –ø—Ä–∏ `DEBUG=0` (—Å—Ç—Ä–æ–∫–∞ 54-55)

#### A2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞: `accounts.security` ‚Äî rate limiting, lockout
- ‚úÖ JWT + Session auth —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
- ‚ö†Ô∏è **P1:** `_require_admin()` –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ `ui/views.py` –∏ `mailer/views.py` ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ
- ‚úÖ RBAC —á–µ—Ä–µ–∑ `User.Role` enum
- ‚ö†Ô∏è **P2:** –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –∫–æ–¥—É ‚Äî –Ω–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —Ä–æ–ª–µ–π
- ‚úÖ Admin –¥–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω (`_admin_has_permission`)

#### A3. –ò–Ω—ä–µ–∫—Ü–∏–∏
- ‚úÖ Django ORM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ ‚Äî SQL injection –∑–∞—â–∏—â–µ–Ω
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ ORM
- ‚ö†Ô∏è **P1:** –í `_apply_company_filters` (ui/views.py:231-236) –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `responsible == "none"` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ –º–∞–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–æ–∫–∞
- ‚úÖ –ù–µ—Ç `raw()` SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
- ‚úÖ Template escaping –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (Django)

#### A4. XSS/CSRF
- ‚úÖ CSRF middleware –≤–∫–ª—é—á–µ–Ω
- ‚úÖ `CSRF_COOKIE_SECURE` –≤ production
- ‚ö†Ô∏è **P1:** CSP –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ f-—Å—Ç—Ä–æ–∫—É (settings.py:87-97) ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ –ª—É—á—à–µ —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- ‚ö†Ô∏è **P2:** `'unsafe-inline'` –≤ CSP –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤/—Å—Ç–∏–ª–µ–π ‚Äî —Å–Ω–∏–∂–∞–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç XSS
- ‚úÖ `X_FRAME_OPTIONS = "DENY"`

#### A5. CORS
- ‚ö†Ô∏è **P1:** `CORS_ALLOWED_ORIGINS` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"http://localhost:5173"` ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ –≤ production, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
- ‚úÖ `CORS_CREDENTIALS = True` ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ö†Ô∏è **P0:** –ù–µ—Ç —è–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –≤ production `CORS_ALLOWED_ORIGINS` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç localhost

#### A6. Session Security
- ‚úÖ `SESSION_COOKIE_HTTPONLY = True`
- ‚úÖ `SESSION_COOKIE_SAMESITE = 'Lax'`
- ‚ö†Ô∏è **P1:** `SESSION_COOKIE_SECURE` —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `DEBUG=0` ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ —Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ production `DEBUG=0`

#### A7. File Upload
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –≤ `CompanyNoteForm` (ui/forms.py:177-178)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME —Ç–∏–ø–∞ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É (ui/forms.py:181-205)
- ‚úÖ –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞: 15 –ú–ë (ui/forms.py:171)
- ‚ö†Ô∏è **P1:** –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `MEDIA_ROOT` –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–∏ ‚Äî –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å (–ø–æ–¥–ø–∞–ø–∫–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é/–∫–æ–º–ø–∞–Ω–∏–∏)
- ‚ö†Ô∏è **P1:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ path traversal –≤ –∏–º–µ–Ω–∞—Ö —Ñ–∞–π–ª–æ–≤ (—Ö–æ—Ç—è Django –æ–±—ã—á–Ω–æ –∑–∞—â–∏—â–∞–µ—Ç)

#### A8. Rate Limiting
- ‚úÖ `RateLimitMiddleware` –¥–ª—è –æ–±—â–µ–≥–æ rate limiting
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –≤ `SecureLoginView` –∏ `SecureTokenObtainPairView`
- ‚ö†Ô∏è **P2:** Rate limiting —á–µ—Ä–µ–∑ cache ‚Äî –µ—Å–ª–∏ Redis —É–ø–∞–¥–µ—Ç, –∑–∞—â–∏—Ç–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ –µ—Å—Ç—å fallback –Ω–∞ LocMemCache)

#### A9. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚ö†Ô∏è **P1:** –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (–Ω–µ—Ç `safety` –∏–ª–∏ `pip-audit` –≤ CI)
- ‚úÖ –í–µ—Ä—Å–∏–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ `requirements.txt`
- ‚ö†Ô∏è **P2:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–∞–∫–µ—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ ‚Äî –Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞

#### A10. Production Configuration
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `SECRET_KEY` –ø—Ä–∏ `DEBUG=0`
- ‚ö†Ô∏è **P0:** `DEBUG` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"1"` (—Å—Ç—Ä–æ–∫–∞ 46) ‚Äî –µ—Å–ª–∏ –∑–∞–±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `DJANGO_DEBUG=0`, –±—É–¥–µ—Ç —É—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ Security headers –≤ production
- ‚ö†Ô∏è **P1:** CSP —Å `'unsafe-inline'` —Å–Ω–∏–∂–∞–µ—Ç –∑–∞—â–∏—Ç—É

### B) RELIABILITY/CORRECTNESS

#### B1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–π exception handler –¥–ª—è DRF (crm/exceptions.py)
- ‚ö†Ô∏è **P1:** –ú–Ω–æ–≥–æ `try/except Exception: pass` –≤ –∫–æ–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, accounts/security.py:106-107, 129-130) ‚Äî —Ç–µ—Ä—è—é—Ç—Å—è –æ—à–∏–±–∫–∏
- ‚ö†Ô∏è **P2:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ `print()` –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö (amocrm/migrate.py) ‚Äî –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å logger

#### B2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å
- ‚úÖ `@transaction.atomic` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö (amocrm/migrate.py:646)
- ‚ö†Ô∏è **P1:** –ù–µ –≤—Å–µ –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±–µ—Ä–Ω—É—Ç—ã –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Å—Å–æ–≤–æ–µ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π

#### B3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Django forms –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –û–±—Ä–µ–∑–∫–∞ —Å—Ç—Ä–æ–∫ –¥–æ max_length (–Ω–∞–ø—Ä–∏–º–µ—Ä, amocrm/migrate.py:494, 502)
- ‚ö†Ô∏è **P1:** –í `_apply_company_filters` –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `responsible` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ UUID) ‚Äî Django ORM –∑–∞—â–∏—Ç–∏—Ç, –Ω–æ –ª—É—á—à–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —è–≤–Ω–æ

#### B4. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚ö†Ô∏è **P2:** –ù–µ—Ç —è–≤–Ω–æ–π –∑–∞—â–∏—Ç—ã –æ—Ç race conditions –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–π/–∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `select_for_update()` –≥–¥–µ –Ω—É–∂–Ω–æ

### C) PRODUCTION READINESS

#### C1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ env
- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ env
- ‚ö†Ô∏è **P1:** `env.example` –Ω–µ–ø–æ–ª–Ω—ã–π ‚Äî –Ω–µ—Ç `REDIS_URL`, `CELERY_BROKER_URL` –∏ –¥—Ä.

#### C2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ (10 MB, 5 backup)
- ‚ö†Ô∏è **P1:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `print()` –≤ amocrm/migrate.py ‚Äî –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ logger
- ‚úÖ –õ–æ–≥–∏ –≤ —Ñ–∞–π–ª —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `DEBUG=0`

#### C3. Health Checks
- ‚úÖ `/health/` endpoint (crm/views.py)
- ‚ö†Ô∏è **P2:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ Celery –≤ health check ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

#### C4. –ú–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Django –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚ö†Ô∏è **P1:** –ù–µ—Ç —è–≤–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ rollback ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã (–Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Django)

#### C5. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Redis –¥–ª—è production, LocMemCache –¥–ª—è dev
- ‚úÖ –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ TTL
- ‚ö†Ô∏è **P2:** –ù–µ—Ç —è–≤–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

#### C6. –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ Celery –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –∑–∞–¥–∞—á (30 –º–∏–Ω hard, 25 –º–∏–Ω soft)
- ‚ö†Ô∏è **P1:** –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞–¥–∞—á ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Flower –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

### D) CODE QUALITY/CONSISTENCY

#### D1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚ö†Ô∏è **P2:** `_require_admin()` –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ `ui/views.py` –∏ `mailer/views.py`
- ‚ö†Ô∏è **P2:** –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–∞–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ª—É—á—à–µ

#### D2. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞
- ‚ö†Ô∏è **P2:** `MAX_LOGIN_ATTEMPTS = 5`, `LOCKOUT_DURATION_SECONDS = 900` ‚Äî —Ö–æ—Ä–æ—à–æ, —á—Ç–æ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –Ω–æ –º–æ–∂–Ω–æ –≤ settings
- ‚ö†Ô∏è **P2:** `"none"` –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ ‚Äî –º–∞–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–æ–∫–∞

#### D3. –°–ª–æ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚ö†Ô∏è **P2:** `migrate_filtered()` –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω–∞—è (900+ —Å—Ç—Ä–æ–∫) ‚Äî –º–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –ø–æ–¥—Ñ—É–Ω–∫—Ü–∏–∏
- ‚ö†Ô∏è **P2:** –ù–µ—Ç unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

### E) PERFORMANCE

#### E1. N+1 –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ `select_related()` –∏ `prefetch_related()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, ui/views.py:781)
- ‚ö†Ô∏è **P2:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞, –≥–¥–µ –µ—Å—Ç—å —Ü–∏–∫–ª—ã –ø–æ QuerySet

#### E2. –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–∞—Ö –∫–æ–º–ø–∞–Ω–∏–π
- ‚ö†Ô∏è **P2:** –ù–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö API endpoints (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ViewSets)

#### E3. –õ–∏–º–∏—Ç—ã
- ‚úÖ –õ–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤
- ‚ö†Ô∏è **P1:** –ù–µ—Ç –ª–∏–º–∏—Ç–∞ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ —ç–∫—Å–ø–æ—Ä—Ç–µ ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

## –≠–¢–ê–ü 2: –û–¢–ß–ï–¢ –ü–†–û–ë–õ–ï–ú

| ID | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ì–¥–µ | –°–∏–º–ø—Ç–æ–º/–†–∏—Å–∫ | –ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ñ–∏–∫—Å | –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å | –†–∏—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π | –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ |
|----|-----------|-----|--------------|--------------|------------------|---------------|----------------|-------------|
| **SEC-001** | P0 | `backend/crm/settings.py:46` | `DEBUG` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"1"` | –ï—Å–ª–∏ –∑–∞–±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `DJANGO_DEBUG=0`, –±—É–¥–µ—Ç —É—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –æ—à–∏–±–∫–∏ | –ò–∑–º–µ–Ω–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç –Ω–∞ `"0"` –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ production `DEBUG=0` | –ù–∏–∑–∫–∏–π | –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–∞ |
| **SEC-002** | P0 | `backend/crm/settings.py:233` | `MAILER_FERNET_KEY` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ –∫–ª—é—á –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –µ—Å–ª–∏ –ø—É—Å—Ç–æ–π –∏ –Ω–µ DEBUG, raise ImproperlyConfigured | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ production | –ù–∏–∑–∫–∏–π | –£–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É |
| **SEC-003** | P0 | `backend/crm/settings.py:261` | `CORS_ALLOWED_ORIGINS` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é localhost | –í production –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –¥–æ—Å—Ç—É–ø —Å localhost | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –µ—Å–ª–∏ –Ω–µ DEBUG –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç localhost, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ/–æ—à–∏–±–∫–∞ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å env –≤ production | –°—Ä–µ–¥–Ω–∏–π | –£–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É |
| **SEC-004** | P1 | `backend/crm/settings.py:80-81` | CSP —Å `'unsafe-inline'` | –°–Ω–∏–∂–∞–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç XSS | –£–±—Ä–∞—Ç—å `'unsafe-inline'`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å nonce –∏–ª–∏ —Ö–µ—à–∏ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ inline —Å–∫—Ä–∏–ø—Ç–æ–≤ | –í—ã—Å–æ–∫–∏–π | –í–µ—Ä–Ω—É—Ç—å `'unsafe-inline'` |
| **SEC-005** | P1 | `backend/ui/views.py:231-236` | –ú–∞–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–æ–∫–∞ `"none"` | –ù–µ–æ—á–µ–≤–∏–¥–Ω–æ, –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ | –í—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `RESPONSIBLE_FILTER_NONE = "none"` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º—É | –ù–∏–∑–∫–∏–π | –í–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä–æ–∫—É |
| **SEC-006** | P1 | `backend/amocrm/migrate.py` (–º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Å—Ç) | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `print()` | –ù–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ, –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–≥–∏ | –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `logger.debug/info/error()` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ | –ù–∏–∑–∫–∏–π | –í–µ—Ä–Ω—É—Ç—å `print()` |
| **SEC-007** | P1 | `backend/accounts/security.py:106-107, 129-130` | `try/except Exception: pass` | –¢–µ—Ä—è—é—Ç—Å—è –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –ø–µ—Ä–µ–¥ `pass` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö | –ù–∏–∑–∫–∏–π | –£–±—Ä–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **SEC-008** | P1 | `backend/ui/forms.py` (file upload) | –§–∞–π–ª—ã –≤ –æ–±—â–µ–º `MEDIA_ROOT` | –ù–µ—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ø–æ–¥–ø–∞–ø–∫–∏ `media/notes/{company_id}/` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ | –°—Ä–µ–¥–Ω–∏–π | –í–µ—Ä–Ω—É—Ç—å –≤ –∫–æ—Ä–µ–Ω—å media |
| **SEC-009** | P1 | `backend/env.example` | –ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä–æ–ª–µ–π | –ú–æ–∂–µ—Ç –≤–≤–µ—Å—Ç–∏ –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ | –£–±—Ä–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª | –ù–∏–∑–∫–∏–π | –í–µ—Ä–Ω—É—Ç—å –ø—Ä–∏–º–µ—Ä—ã |
| **SEC-010** | P1 | `backend/ui/views.py`, `backend/mailer/views.py` | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `_require_admin()` | –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | –í—ã–Ω–µ—Å—Ç–∏ –≤ `accounts/permissions.py` –∏–ª–∏ `crm/utils.py` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω—Å–∫–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º | –ù–∏–∑–∫–∏–π | –í–µ—Ä–Ω—É—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **REL-001** | P1 | `backend/ui/views.py:871-940` (company_bulk_transfer) | –ù–µ—Ç —è–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –ü—Ä–∏ –æ—à–∏–±–∫–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –û–±–µ—Ä–Ω—É—Ç—å –≤ `@transaction.atomic` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Å—Å–æ–≤–æ–µ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ù–∏–∑–∫–∏–π | –£–±—Ä–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä |
| **REL-002** | P1 | `backend/ui/views.py:210-274` (_apply_company_filters) | –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ | –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–µ–≤–µ—Ä–Ω–æ–º —Ç–∏–ø–µ | –î–æ–±–∞–≤–∏—Ç—å `try/except ValueError` –ø—Ä–∏ `int()` –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è—Ö | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã —Å –Ω–µ–≤–µ—Ä–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ | –ù–∏–∑–∫–∏–π | –£–±—Ä–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é |
| **PROD-001** | P1 | `backend/env.example` | –ù–µ–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö | –ù–µ—è—Å–Ω–æ, –∫–∞–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã | –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª | –ù–∏–∑–∫–∏–π | –£–±—Ä–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ |
| **PROD-002** | P2 | `backend/crm/views.py` (health_check) | –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ Celery | –ù–µ –≤–∏–¥–Ω–æ, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ Celery | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `celery.control.inspect().active()` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint | –°—Ä–µ–¥–Ω–∏–π | –£–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É |
| **PROD-003** | P1 | `backend/ui/views.py` (company_export) | –ù–µ—Ç –ª–∏–º–∏—Ç–∞ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π | –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å –±–æ–ª—å—à–∏–º–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞–º–∏ | –î–æ–±–∞–≤–∏—Ç—å –ª–∏–º–∏—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10000) –∏–ª–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—é | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö | –°—Ä–µ–¥–Ω–∏–π | –£–±—Ä–∞—Ç—å –ª–∏–º–∏—Ç |
| **QUAL-001** | P2 | `backend/amocrm/migrate.py:590-1488` | –û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è | –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å | –†–∞–∑–±–∏—Ç—å –Ω–∞ –ø–æ–¥—Ñ—É–Ω–∫—Ü–∏–∏ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é | –í—ã—Å–æ–∫–∏–π | –í–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –±—ã–ª–æ |
| **PERF-001** | P2 | API ViewSets | –í–æ–∑–º–æ–∂–Ω—ã N+1 –∑–∞–ø—Ä–æ—Å—ã | –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ ViewSets | –î–æ–±–∞–≤–∏—Ç—å `select_related/prefetch_related` –≥–¥–µ –Ω—É–∂–Ω–æ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ Django Debug Toolbar | –°—Ä–µ–¥–Ω–∏–π | –£–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ |

---

## –≠–¢–ê–ü 3: –ë–ï–ó–û–ü–ê–°–ù–´–ï –ü–†–ê–í–ö–ò

### ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ (P0)

#### 1. **SEC-001:** –ü—Ä–æ–≤–µ—Ä–∫–∞ DEBUG –≤ production ‚úÖ
**–§–∞–π–ª:** `backend/crm/settings.py:48-63`  
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–¥–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ `DEBUG=True` –≤ production-like –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ `ALLOWED_HOSTS`).  
**–í–ª–∏—è–Ω–∏–µ:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫.  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å `ALLOWED_HOSTS=crm.example.ru` –∏ `DJANGO_DEBUG=1` –±—É–¥–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.  
**–û—Ç–∫–∞—Ç:** –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ 48-63.

#### 2. **SEC-002:** –ü—Ä–æ–≤–µ—Ä–∫–∞ MAILER_FERNET_KEY ‚úÖ
**–§–∞–π–ª:** `backend/crm/settings.py:252-260`  
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–¥–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ `MAILER_FERNET_KEY` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ production.  
**–í–ª–∏—è–Ω–∏–µ:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ (mailer –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º).  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å `DEBUG=0` –∏ –±–µ–∑ `MAILER_FERNET_KEY` –±—É–¥–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.  
**–û—Ç–∫–∞—Ç:** –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ 252-260.

#### 3. **SEC-003:** –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS_ALLOWED_ORIGINS ‚úÖ
**–§–∞–π–ª:** `backend/crm/settings.py:290-299`  
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–¥–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ `CORS_ALLOWED_ORIGINS` —Å–æ–¥–µ—Ä–∂–∏—Ç localhost –≤ production.  
**–í–ª–∏—è–Ω–∏–µ:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫.  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å `DEBUG=0` –∏ `CORS_ALLOWED_ORIGINS=http://localhost:5173` –±—É–¥–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ‚Äî `CORS_ALLOWED_ORIGINS=` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—É—Å—Ç—ã–º, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏—Å—á–µ–∑–ª–æ.  
**–û—Ç–∫–∞—Ç:** –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ 290-299.

### ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ P1 (–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ)

#### 4. **SEC-006:** –ó–∞–º–µ–Ω–∞ print() –Ω–∞ logger ‚úÖ
**–§–∞–π–ª:** `backend/amocrm/migrate.py`  
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –í—Å–µ `print()` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `logger.debug()` / `logger.error()` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `exc_info=True` –¥–ª—è traceback.  
**–í–ª–∏—è–Ω–∏–µ:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ø–µ—Ä—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤.  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏–∑ amoCRM –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏.  
**–û—Ç–∫–∞—Ç:** –í–µ—Ä–Ω—É—Ç—å `print()`.

#### 5. **SEC-007:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–º–µ—Å—Ç–æ pass ‚úÖ
**–§–∞–π–ª:** `backend/accounts/security.py:106-107, 129-130`  
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –í–º–µ—Å—Ç–æ `except Exception: pass` –¥–æ–±–∞–≤–ª–µ–Ω–æ `logger.warning()` —Å `exc_info=True`.  
**–í–ª–∏—è–Ω–∏–µ:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ ‚Äî —Ç–µ–ø–µ—Ä—å –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö.  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.  
**–û—Ç–∫–∞—Ç:** –í–µ—Ä–Ω—É—Ç—å `pass`.

#### 6. **SEC-010:** –í—ã–Ω–æ—Å _require_admin() –≤ –æ–±—â–∏–π –º–æ–¥—É–ª—å ‚úÖ
**–§–∞–π–ª—ã:** `backend/crm/utils.py` (–Ω–æ–≤—ã–π), `backend/ui/views.py`, `backend/mailer/views.py`  
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω –æ–±—â–∏–π –º–æ–¥—É–ª—å `crm.utils` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `require_admin()`, –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∏–º–ø–æ—Ä—Ç –∏–∑ –æ–±—â–µ–≥–æ –º–æ–¥—É–ª—è.  
**–í–ª–∏—è–Ω–∏–µ:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ ‚Äî –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∫–æ–¥–∞, –ª–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å.  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω—Å–∫–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º (settings, import, amocrm –∏ —Ç.–¥.).  
**–û—Ç–∫–∞—Ç:** –í–µ—Ä–Ω—É—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `_require_admin()`.

#### 7. **REL-001:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ bulk_transfer ‚úÖ
**–§–∞–π–ª:** `backend/ui/views.py:879`  
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transaction.atomic` –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é `company_bulk_transfer`, —É–±—Ä–∞–Ω –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `with transaction.atomic()`.  
**–í–ª–∏—è–Ω–∏–µ:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ ‚Äî —Ç–µ–ø–µ—Ä—å –≤—Å—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–∫–∞—Ç –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Å—Å–æ–≤–æ–µ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ).  
**–û—Ç–∫–∞—Ç:** –£–±—Ä–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä, –≤–µ—Ä–Ω—É—Ç—å `with transaction.atomic()`.

---

## –≠–¢–ê–ü 4: PRODUCTION CHECKLIST

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

**P0 (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ):**
- ‚úÖ SEC-001: –ü—Ä–æ–≤–µ—Ä–∫–∞ DEBUG –≤ production
- ‚úÖ SEC-002: –ü—Ä–æ–≤–µ—Ä–∫–∞ MAILER_FERNET_KEY
- ‚úÖ SEC-003: –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS_ALLOWED_ORIGINS (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `CORS_ALLOWED_ORIGINS=` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—É—Å—Ç—ã–º)

**P1 (–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ):**
- ‚úÖ SEC-006: –ó–∞–º–µ–Ω–∞ print() –Ω–∞ logger
- ‚úÖ SEC-007: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–º–µ—Å—Ç–æ pass
- ‚úÖ SEC-010: –í—ã–Ω–æ—Å _require_admin() –≤ –æ–±—â–∏–π –º–æ–¥—É–ª—å
- ‚úÖ REL-001: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ bulk_transfer
- ‚úÖ SEC-005: –í—ã–Ω–µ—Å–µ–Ω–∞ –º–∞–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–æ–∫–∞ "none" –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É RESPONSIBLE_FILTER_NONE
- ‚úÖ SEC-009: –£–±—Ä–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –ø–∞—Ä–æ–ª–µ–π –∏–∑ env.example
- ‚úÖ PROD-001: –î–æ–ø–æ–ª–Ω–µ–Ω env.example –≤—Å–µ–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ REL-002: –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –≤ _apply_company_filters (try/except –¥–ª—è int())

### üìã Production Checklist

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è production:**
```bash
# Django
DJANGO_SECRET_KEY=<50+ —Å–∏–º–≤–æ–ª–æ–≤, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ>
DJANGO_DEBUG=0
DJANGO_ALLOWED_HOSTS=crm.groupprofi.ru,–¥—Ä—É–≥–∏–µ_–¥–æ–º–µ–Ω—ã
DJANGO_CSRF_TRUSTED_ORIGINS=https://crm.groupprofi.ru

# Database
DB_ENGINE=postgres
POSTGRES_DB=crm
POSTGRES_USER=crm
POSTGRES_PASSWORD=<—Å–∏–ª—å–Ω—ã–π_–ø–∞—Ä–æ–ª—å>
POSTGRES_HOST=db
POSTGRES_PORT=5432

# Security
DJANGO_SECURE_SSL_REDIRECT=1
DJANGO_SESSION_COOKIE_SECURE=1
DJANGO_CSRF_COOKIE_SECURE=1
DJANGO_SECURE_HSTS_SECONDS=3600

# Mailer (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
MAILER_FERNET_KEY=<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())">
PUBLIC_BASE_URL=https://crm.groupprofi.ru

# Security contact
SECURITY_CONTACT_EMAIL=security@example.com

# Redis/Celery
REDIS_URL=redis://redis:6379/0
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/2

# CORS (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)
CORS_ALLOWED_ORIGINS=
```

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**
```bash
DJANGO_LANGUAGE_CODE=ru-ru
DJANGO_TIME_ZONE=Europe/Moscow
DJANGO_DATA_UPLOAD_MAX_MEMORY_SIZE=20971520
DJANGO_FILE_UPLOAD_MAX_MEMORY_SIZE=20971520
```

#### –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Å–±–æ—Ä–∫–∞:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/proficrm
git pull
docker-compose -f docker-compose.yml -f docker-compose.vds.yml up -d --build
```

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
```bash
docker-compose -f docker-compose.yml -f docker-compose.vds.yml exec web python manage.py migrate
```

**–°–±–æ—Ä —Å—Ç–∞—Ç–∏–∫–∏:**
```bash
docker-compose -f docker-compose.yml -f docker-compose.vds.yml exec web python manage.py collectstatic --noinput
```

**–°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```bash
docker-compose -f docker-compose.yml -f docker-compose.vds.yml exec web python manage.py createsuperuser
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```bash
docker-compose -f docker-compose.yml -f docker-compose.vds.yml exec web python manage.py check --deploy
```

#### –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

**–õ–æ–≥–∏:**
- –§–∞–π–ª: `/app/backend/logs/crm.log` (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
- –†–æ—Ç–∞—Ü–∏—è: 10 MB, 5 backup —Ñ–∞–π–ª–æ–≤
- –£—Ä–æ–≤–µ–Ω—å: INFO –≤ production, DEBUG –≤ development
- –§–æ—Ä–º–∞—Ç: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (verbose)

**Health Check:**
- Endpoint: `/health/`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: –ë–î, Redis (cache), Celery
- –§–æ—Ä–º–∞—Ç: JSON `{"status": "ok", "checks": {...}}`

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫: `docker-compose logs web | grep -i error`
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å health endpoint: `curl https://crm.groupprofi.ru/health/`
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å Celery: `docker-compose logs celery | tail -20`

#### Security Hardening

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ DEBUG=0 –≤ production (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
- ‚úÖ SECRET_KEY –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è (50+ —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ Security headers (CSP, X-Frame-Options, HSTS)
- ‚úÖ CSRF –∑–∞—â–∏—Ç–∞ –≤–∫–ª—é—á–µ–Ω–∞
- ‚úÖ Session cookies: HttpOnly, Secure, SameSite
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ (rate limiting, lockout)
- ‚úÖ File upload –≤–∞–ª–∏–¥–∞—Ü–∏—è (—Ä–∞–∑–º–µ—Ä, —Ç–∏–ø, MIME)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –ë–î
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry, Prometheus –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏)
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pip list --outdated`)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

#### Rollback Strategy

**–û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```bash
cd /opt/proficrm
git log --oneline -10  # –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π –∫–æ–º–º–∏—Ç
git revert <commit_hash>  # –∏–ª–∏
git reset --hard <commit_hash>
docker-compose -f docker-compose.yml -f docker-compose.vds.yml restart web
```

**–û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π:**
```bash
docker-compose -f docker-compose.yml -f docker-compose.vds.yml exec web python manage.py migrate <app_name> <migration_number>
```

#### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ SLO

- Health check –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `{"status": "ok"}` –≤ —Ç–µ—á–µ–Ω–∏–µ 1 —Å–µ–∫—É–Ω–¥—ã
- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —Å–µ–∫—É–Ω–¥
- API endpoints –¥–æ–ª–∂–Ω—ã –æ—Ç–≤–µ—á–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 1 —Å–µ–∫—É–Ω–¥—ã
- Celery –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞ (30 –º–∏–Ω)

---

## –°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û—Å—Ç–∞–≤—à–∏–µ—Å—è P1 (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ–∑–∂–µ):**
- SEC-004: –£–±—Ä–∞—Ç—å 'unsafe-inline' –∏–∑ CSP (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å UI)
- SEC-008: –ò–∑–æ–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ –ø–æ–¥–ø–∞–ø–∫–∞–º (—É–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤)
- PROD-003: –î–æ–±–∞–≤–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç –∫–æ–º–ø–∞–Ω–∏–π (–∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ–ª—å—à–∏—Ö —ç–∫—Å–ø–æ—Ä—Ç–æ–≤)

**P2 (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):**
- PROD-002: –ü—Ä–æ–≤–µ—Ä–∫–∞ Celery –≤ health check (—É–∂–µ –µ—Å—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ)
- QUAL-001: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ migrate_filtered()
- PERF-001: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ API
