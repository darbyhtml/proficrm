<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Вход — CRM ПРОФИ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                teal: "#01948E",
                orange: "#FDAD3A",
                dark: "#003D38",
                soft: "#C2E2DE",
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-brand-soft/40 text-brand-dark min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white border border-brand-soft rounded-2xl shadow-sm overflow-hidden">
      <!-- Вкладки -->
      <div class="flex border-b border-brand-soft">
        <button 
          type="button"
          id="tab-access-key"
          class="flex-1 px-4 py-3 text-sm font-medium text-center transition-colors bg-brand-teal text-white"
          onclick="switchTab('access-key')"
        >
          По ключу доступа
        </button>
        <button 
          type="button"
          id="tab-password"
          class="flex-1 px-4 py-3 text-sm font-medium text-center transition-colors text-brand-dark/60 hover:text-brand-dark hover:bg-brand-soft/20"
          onclick="switchTab('password')"
        >
          По логину и паролю
        </button>
      </div>

      <div class="p-6">
        <div class="mb-4">
          <div class="text-xl font-semibold">Вход</div>
          <div class="text-sm text-brand-dark/70" id="login-description">
            Вставьте ключ доступа, полученный от администратора
          </div>
        </div>

        {% if form.errors or error_message %}
          <div class="mb-4 rounded-lg border border-brand-orange/60 bg-brand-orange/20 p-3 text-sm text-brand-dark">
            {% if error_message %}
              {{ error_message }}
            {% else %}
              Проверь данные для входа.
            {% endif %}
          </div>
        {% endif %}

        <!-- Форма входа по ключу доступа -->
        <form method="post" id="form-access-key" class="space-y-3">
          {% csrf_token %}
          {% if next %}<input type="hidden" name="next" value="{{ next }}" />{% endif %}
          <input type="hidden" name="login_type" value="access_key" />
          <div>
            <label class="block text-sm text-brand-dark/80 mb-1">Ключ доступа</label>
            <input name="access_key" type="text" required autofocus class="w-full rounded-lg border border-brand-soft px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-teal/30 font-mono text-sm" placeholder="Вставьте ключ доступа, полученный от администратора" />
            <div class="text-xs text-brand-dark/60 mt-1">Ключ доступа выдается администратором. Действует 24 часа, одноразовый.</div>
          </div>
          <button class="w-full rounded-lg bg-brand-teal text-white py-2 hover:bg-brand-dark active:scale-[0.99]">
            Войти
          </button>
        </form>

        <!-- Форма входа по логину и паролю -->
        <form method="post" id="form-password" class="space-y-3 hidden">
          {% csrf_token %}
          {% if next %}<input type="hidden" name="next" value="{{ next }}" />{% endif %}
          <input type="hidden" name="login_type" value="password" />
          <div>
            <label class="block text-sm text-brand-dark/80 mb-1">Логин</label>
            <input name="username" type="text" required class="w-full rounded-lg border border-brand-soft px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-teal/30" />
          </div>
          <div>
            <label class="block text-sm text-brand-dark/80 mb-1">Пароль</label>
            <input name="password" type="password" required class="w-full rounded-lg border border-brand-soft px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-teal/30" />
            <div class="text-xs text-brand-dark/60 mt-1">Доступно только для администраторов.</div>
          </div>
          <button class="w-full rounded-lg bg-brand-teal text-white py-2 hover:bg-brand-dark active:scale-[0.99]">
            Войти
          </button>
        </form>
      </div>
    </div>

    <script>
      function switchTab(tab) {
        const accessKeyTab = document.getElementById('tab-access-key');
        const passwordTab = document.getElementById('tab-password');
        const accessKeyForm = document.getElementById('form-access-key');
        const passwordForm = document.getElementById('form-password');
        const description = document.getElementById('login-description');

        if (tab === 'access-key') {
          // Активируем вкладку "По ключу доступа"
          accessKeyTab.classList.remove('text-brand-dark/60', 'hover:text-brand-dark', 'hover:bg-brand-soft/20');
          accessKeyTab.classList.add('bg-brand-teal', 'text-white');
          passwordTab.classList.remove('bg-brand-teal', 'text-white');
          passwordTab.classList.add('text-brand-dark/60', 'hover:text-brand-dark', 'hover:bg-brand-soft/20');
          
          accessKeyForm.classList.remove('hidden');
          passwordForm.classList.add('hidden');
          description.textContent = 'Вставьте ключ доступа, полученный от администратора';
          
          // Фокус на поле ключа
          const accessKeyInput = accessKeyForm.querySelector('input[name="access_key"]');
          if (accessKeyInput) {
            accessKeyInput.focus();
          }
        } else {
          // Активируем вкладку "По логину и паролю"
          passwordTab.classList.remove('text-brand-dark/60', 'hover:text-brand-dark', 'hover:bg-brand-soft/20');
          passwordTab.classList.add('bg-brand-teal', 'text-white');
          accessKeyTab.classList.remove('bg-brand-teal', 'text-white');
          accessKeyTab.classList.add('text-brand-dark/60', 'hover:text-brand-dark', 'hover:bg-brand-soft/20');
          
          passwordForm.classList.remove('hidden');
          accessKeyForm.classList.add('hidden');
          description.textContent = 'Вход по логину и паролю (только для администраторов)';
          
          // Фокус на поле логина
          const usernameInput = passwordForm.querySelector('input[name="username"]');
          if (usernameInput) {
            usernameInput.focus();
          }
        }
      }
    </script>
  </body>
</html>
