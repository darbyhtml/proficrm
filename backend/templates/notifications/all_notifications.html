{% extends "ui/base.html" %}
{% block title %}Все уведомления — CRM ПРОФИ{% endblock %}

{% block content %}
  <div class="space-y-4">
    <div class="flex items-end justify-between gap-4">
      <div>
        <h1 class="text-2xl font-semibold">Все уведомления</h1>
        <div class="text-sm text-brand-dark/70">
          Всего: <b>{{ total_count }}</b> · Непрочитанных: <b>{{ unread_count }}</b> · Прочитанных: <b>{{ read_count }}</b>
        </div>
      </div>
      <form method="post" action="/notifications/mark-all-read/">
        {% csrf_token %}
        <button class="btn btn-outline" type="submit">Отметить все прочитанными</button>
      </form>
    </div>

    {% if unread_notifications %}
      <div class="bg-white border rounded-2xl p-4">
        <h2 class="text-lg font-semibold mb-3 text-brand-dark">Непрочитанные ({{ unread_count }})</h2>
        <div class="space-y-2">
          {% for n in unread_notifications %}
            <div class="rounded-xl border border-brand-soft px-4 py-3 bg-brand-soft/20">
              <div class="flex items-start justify-between gap-3">
                <div class="flex-1">
                  <div class="text-sm font-medium">{{ n.title }}</div>
                  {% if n.body %}
                    <div class="text-xs muted mt-1">{{ n.body }}</div>
                  {% endif %}
                  <div class="text-[11px] muted-2 mt-2">{{ n.created_at|date:"d.m.Y H:i" }}</div>
                </div>
                <div class="flex items-center gap-2">
                  {% if n.url %}
                    <a href="{{ n.url }}" class="btn btn-outline" style="padding:.35rem .6rem;font-size:.75rem">Открыть</a>
                  {% endif %}
                  <form method="post" action="/notifications/{{ n.id }}/read/" class="js-notif-read-form">
                    {% csrf_token %}
                    <button class="btn btn-outline" style="padding:.35rem .6rem;font-size:.75rem" type="submit" title="Отметить прочитанным">✓</button>
                  </form>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% if read_notifications %}
      <div class="bg-white border rounded-2xl p-4">
        <h2 class="text-lg font-semibold mb-3 text-brand-dark/70">Прочитанные ({{ read_count }})</h2>
        <div class="space-y-2">
          {% for n in read_notifications %}
            <div class="rounded-xl border border-brand-soft px-4 py-3 bg-white opacity-75">
              <div class="flex items-start justify-between gap-3">
                <div class="flex-1">
                  <div class="text-sm font-medium text-brand-dark/70">{{ n.title }}</div>
                  {% if n.body %}
                    <div class="text-xs muted mt-1">{{ n.body }}</div>
                  {% endif %}
                  <div class="text-[11px] muted-2 mt-2">{{ n.created_at|date:"d.m.Y H:i" }}</div>
                </div>
                {% if n.url %}
                  <a href="{{ n.url }}" class="btn btn-outline" style="padding:.35rem .6rem;font-size:.75rem">Открыть</a>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% if not unread_notifications and not read_notifications %}
      <div class="bg-white border rounded-2xl p-8 text-center">
        <div class="text-brand-dark/50 text-lg">Уведомлений пока нет</div>
      </div>
    {% endif %}
  </div>
{% endblock %}
