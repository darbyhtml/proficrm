<div id="taskViewModal" class="fixed inset-0 z-[200]">
  <div class="fixed inset-0 bg-black/35" data-close-task-view></div>
  <div class="absolute inset-x-4 top-12 mx-auto max-w-2xl max-h-[90vh] overflow-y-auto">
    <div class="card card-pad">
      <div class="flex items-start justify-between gap-3 mb-4">
        <div class="flex-1">
          <div class="flex items-center justify-between gap-2 mb-2">
            <div class="flex items-center gap-2">
              {# Задача (тип задачи) - используем TaskType если есть #}
              {% if view_task.type %}
                {% include "ui/partials/task_type_badge.html" with task_type=view_task.type only %}
              {% endif %}
              {% if view_task.can_edit_task %}
                <button type="button" class="btn btn-outline" style="padding:.35rem .6rem;font-size:.75rem" data-edit-task data-task-id="{{ view_task.id }}">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M12 20h9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Редактировать
                </button>
              {% endif %}
            </div>
            {# Системный статус справа #}
            <span class="badge {% if view_task.status == 'new' %}badge-new{% elif view_task.status == 'in_progress' %}badge-progress{% elif view_task.status == 'done' %}badge-done{% elif view_task.status == 'cancelled' %}badge-cancel{% endif %}">
              {{ view_task.get_status_display }}
            </span>
          </div>
          <h2 class="text-xl font-semibold text-brand-dark">{{ view_task.title }}</h2>
          {% if view_task.description %}
            <div class="text-sm text-brand-dark/70 mt-2 whitespace-pre-wrap">{{ view_task.description }}</div>
          {% endif %}
        </div>
        <button type="button" class="btn btn-outline flex-shrink-0" style="padding:.35rem .5rem;font-size:.875rem" data-close-task-view aria-label="Закрыть" title="Закрыть">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      
      <div class="space-y-3 pt-3 border-t">
        {% if view_task.company %}
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-brand-dark/60 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
            <div class="flex-1 min-w-0">
              <div class="text-xs text-brand-dark/60 mb-0.5">Компания</div>
              <a href="/companies/{{ view_task.company.id }}/" class="link font-medium">{{ view_task.company.name }}</a>
            </div>
          </div>
        {% endif %}
        
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-brand-dark/60 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
          <div class="flex-1 min-w-0">
            <div class="text-xs text-brand-dark/60 mb-0.5">Ответственный</div>
            <div class="font-medium">{{ view_task.assigned_to|default:"Не назначен" }}</div>
          </div>
        </div>
        
        {% if view_task.created_at %}
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-brand-dark/60 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div class="flex-1 min-w-0">
              <div class="text-xs text-brand-dark/60 mb-0.5">Поставлена</div>
              <div class="font-medium">{{ view_task.created_at|date:"d.m.Y H:i" }}</div>
            </div>
          </div>
        {% endif %}
        
        {% if view_task.due_at %}
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-brand-dark/60 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            <div class="flex-1 min-w-0">
              <div class="text-xs text-brand-dark/60 mb-0.5">Дедлайн</div>
              <div class="font-medium {% if view_task.due_at < local_now %}text-red-700{% endif %}">{{ view_task.due_at|date:"d.m.Y H:i" }}</div>
            </div>
          </div>
        {% endif %}
        
        {% if view_task.completed_at %}
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-brand-dark/60 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div class="flex-1 min-w-0">
              <div class="text-xs text-brand-dark/60 mb-0.5">Выполнена</div>
              <div class="font-medium text-green-700">{{ view_task.completed_at|date:"d.m.Y H:i" }}</div>
            </div>
          </div>
        {% endif %}
        
        {% if view_task_overdue_days and view_task_overdue_days > 0 %}
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div class="flex-1 min-w-0">
              <div class="text-xs text-red-600 mb-0.5">Просрочка</div>
              <div class="font-medium text-red-700">Выполнена на {{ view_task_overdue_days }} {{ view_task_overdue_days|pluralize:"день,дня,дней" }} позже дедлайна</div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
