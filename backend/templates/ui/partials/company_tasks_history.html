{% load ui_extras %}

{% if tasks %}
  <div class="space-y-2">
    {% for t in tasks %}
      <div class="rounded-lg border border-brand-soft p-3 bg-white/80">
        <div class="flex items-start justify-between gap-3">
          <div class="flex-1 min-w-0">
            <div class="flex items-start gap-2 mb-1">
              {% if t.type %}
                {% include "ui/partials/task_type_badge.html" with task_type=t.type only %}
              {% else %}
                <span class="inline-flex items-center text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-800">
                  {{ t.title|default:"Без названия" }}
                </span>
              {% endif %}
            </div>
            {% if t.description %}
              <div class="text-xs text-brand-dark/80 mt-1" style="line-height:1.4">
                {{ t.description|truncatechars:200 }}
              </div>
            {% endif %}
            <div class="mt-2 space-y-0.5 text-[11px] text-brand-dark/70">
              <div>
                <span class="font-semibold">Статус:</span>
                {{ t.get_status_display }}
              </div>
              <div>
                <span class="font-semibold">Поставил:</span>
                {{ t.created_by|default:"—" }}
                {% if t.created_at %}
                  · {{ t.created_at }}
                {% endif %}
              </div>
              <div>
                <span class="font-semibold">Ответственный:</span>
                {{ t.assigned_to|default:"—" }}
              </div>
              <div class="flex flex-wrap gap-x-4 gap-y-0.5">
                <span>
                  <span class="font-semibold">Дедлайн:</span>
                  {% if t.due_at %}{{ t.due_at }}{% else %}—{% endif %}
                </span>
                <span>
                  <span class="font-semibold">Выполнено:</span>
                  {% if t.completed_at %}{{ t.completed_at }}{% else %}—{% endif %}
                </span>
              </div>
            </div>
          </div>
          <div class="text-right text-[11px] text-brand-dark/60 flex-shrink-0">
            <div class="mb-1">ID: {{ t.id }}</div>
            <button
              type="button"
              class="inline-flex items-center gap-1 text-xs text-brand-teal hover:text-brand-dark"
              data-view-task
              data-task-id="{{ t.id }}"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <polyline points="11 8 11 11 14 12"></polyline>
              </svg>
              Открыть
            </button>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  <div class="text-[11px] text-brand-dark/50 mt-3">
    Показаны последние {{ tasks|length }} задач(и).
  </div>
{% else %}
  <div class="text-sm text-brand-dark/70 py-4 text-center">
    Выполненных задач по этой компании пока нет.
  </div>
{% endif %}

