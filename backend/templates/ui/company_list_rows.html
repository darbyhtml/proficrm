{% for c in companies %}
  <tr onclick="window.location='/companies/{{ c.id }}/'" style="cursor:pointer" class="{% if c.has_overdue %}company-row-overdue{% endif %}">
    <td onclick="event.stopPropagation()">
      <input class="bulk-company" type="checkbox" name="company_ids" value="{{ c.id }}" form="bulkTransferForm" data-can-transfer="{% if c.can_transfer %}1{% else %}0{% endif %}" />
    </td>
    {% if "name" in company_list_columns %}
      <td>
        <a class="link" href="/companies/{{ c.id }}/" onclick="event.stopPropagation()">
          {% if search_query and c.search_name_html %}
            {{ c.search_name_html|safe }}
          {% else %}
            {{ c.name }}
          {% endif %}
        </a>
        {% if "address" in company_list_columns %}
          <div class="text-xs text-brand-dark/70">
            {% if search_query and c.search_address_html %}
              {{ c.search_address_html|safe }}
            {% else %}
              {{ c.address }}
            {% endif %}
          </div>
        {% endif %}
        {% if search_query and c.search_reasons %}
          <div class="text-xs mt-1 search-reasons" style="color: #f97316; font-weight: 500;">
            Найдено:
            {% for r in c.search_reasons %}
              <span class="ml-1"><b>{{ r.label }}</b>: <span class="search-reasons-value">{{ r.value_html|safe }}</span></span>{% if not forloop.last %}<span class="opacity-50"> · </span>{% endif %}
            {% endfor %}
          </div>
        {% endif %}
      </td>
    {% endif %}
    {% if "overdue" in company_list_columns %}
      <td>
        {% if c.has_overdue %}
          <span class="badge badge-warn">Да</span>
        {% else %}
          <span class="muted-2">—</span>
        {% endif %}
      </td>
    {% endif %}
    {% if "inn" in company_list_columns %}
      <td>
        {% if search_query and c.search_inn_html %}
          {{ c.search_inn_html|safe }}
        {% else %}
          {{ c.inn }}
        {% endif %}
      </td>
    {% endif %}
    {% if "status" in company_list_columns %}
      <td>
        {% if c.status %}
          <span class="badge">{{ c.status.name }}</span>
        {% else %}
          <span class="muted-2">—</span>
        {% endif %}
      </td>
    {% endif %}
    {% if "spheres" in company_list_columns %}
      <td>
        {% for s in c.spheres.all %}
          <span class="badge mr-1 mb-1 inline-flex items-center gap-1">
            {{ s.name }}
            {% if s.is_important %}
              <span
                class="inline-flex items-center justify-center rounded-full border border-brand-orange/80 text-brand-orange bg-white"
                style="width:0.95rem;height:0.95rem;border-width:1.5px;"
                title="Важная сфера: решение об обучении принимает головная организация или требуется особое внимание"
              >
                <span style="font-size:0.6rem;line-height:1;font-weight:700;">?</span>
              </span>
            {% endif %}
          </span>
        {% empty %}
          <span class="text-brand-dark/70">—</span>
        {% endfor %}
      </td>
    {% endif %}
    {% if "responsible" in company_list_columns %}<td>{% if c.responsible %}{{ c.responsible }}{% endif %}</td>{% endif %}
    {% if "branch" in company_list_columns %}<td>{{ c.branch }}</td>{% endif %}
    {% if "region" in company_list_columns %}<td>{{ c.region }}</td>{% endif %}
    {% if "updated_at" in company_list_columns %}
      <td class="muted">
        <div>{{ c.updated_at|date:"d.m.Y H:i" }}</div>
        <div class="text-xs text-brand-dark/60 mt-0.5" data-updated-at="{{ c.updated_at|date:'c' }}"></div>
      </td>
    {% endif %}
  </tr>
{% empty %}
  <tr><td class="muted" colspan="20" style="padding:1.25rem 1rem">Ничего не найдено.</td></tr>
{% endfor %}
