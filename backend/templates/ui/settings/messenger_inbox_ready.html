{% extends "ui/base.html" %}
{% load static %}
{% block title %}Источник готов — CRM ПРОФИ{% endblock %}

{% block content %}
  <div class="max-w-2xl mx-auto space-y-6">
    <div class="flex items-center gap-3 text-sm text-brand-dark/70">
      <a class="underline" href="{% url 'settings_dashboard' %}">Настройки</a> / <a class="underline" href="{% url 'settings_messenger_overview' %}">Live-chat</a> / Источники /
    </div>

    <div class="text-center py-4">
      <h1 class="text-2xl font-semibold text-brand-dark">Источник готов!</h1>
      <p class="text-brand-dark/70 mt-2">
        Вы успешно создали источник «{{ inbox.name }}». Скопируйте код ниже и вставьте на ваш сайт. Когда клиент напишет в чат, диалог появится в разделе «Диалоги».
      </p>
    </div>

    <div class="bg-brand-soft/20 border border-brand-soft/60 rounded-xl p-4">
      <label class="block text-sm font-medium text-brand-dark/80 mb-2">Код вставки на сайт</label>
      <pre class="bg-brand-dark text-white p-4 rounded-lg text-xs overflow-x-auto" id="embed-code"><code>&lt;script src="{{ base_url }}/static/messenger/widget.js" data-widget-token="{{ inbox.widget_token }}" data-api-base-url="{{ base_url }}"&gt;&lt;/script&gt;</code></pre>
      <div class="mt-3 flex flex-wrap gap-3">
        <button type="button" onclick="copyCode()" class="btn btn-primary btn-sm">Копировать</button>
      </div>
    </div>

    <div class="flex flex-wrap gap-3 justify-center">
      <a href="{% url 'settings_messenger_inbox_edit' inbox.id %}" class="btn btn-outline">Больше параметров</a>
      <a href="{% url 'settings_messenger_overview' %}" class="btn btn-primary">Перейти к источникам</a>
    </div>
  </div>
  <script>
    function copyCode() {
      var code = '<script src="{{ base_url }}/static/messenger/widget.js" data-widget-token="{{ inbox.widget_token }}" data-api-base-url="{{ base_url }}"><' + '/script>';
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(code).then(function() { alert('Код скопирован в буфер обмена'); });
      } else {
        var ta = document.createElement('textarea'); ta.value = code; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); alert('Код скопирован');
      }
    }
  </script>
{% endblock %}
