# –î–æ—Å–∫–æ–Ω–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞—à–µ–≥–æ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ —Å Chatwoot

**–¶–µ–ª—å:** –í—ã—è–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã –∏ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –¥–æ–≤–µ–¥–µ–Ω–∏—è live-chat –¥–æ production-ready —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π Chatwoot.

**–ü—Ä–∏–Ω—Ü–∏–ø:** Chatwoot ‚Äî –∏–¥–µ–∞–ª, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è. –û–ø–∏—Ä–∞–µ–º—Å—è –Ω–∞ –µ–≥–æ –º–µ—Ç–æ–¥—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞–∫ –Ω–∞ —ç—Ç–∞–ª–æ–Ω.

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö](#–º–æ–¥–µ–ª–∏-–¥–∞–Ω–Ω—ã—Ö)
2. [–ò–Ω–¥–µ–∫—Å—ã –ë–î](#–∏–Ω–¥–µ–∫—Å—ã-–±–¥)
3. [–°–µ—Ä–≤–∏—Å—ã –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞](#—Å–µ—Ä–≤–∏—Å—ã-–∏-–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
4. [Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è](#real-time-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è)
5. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–≤–∞–ª–∏–¥–∞—Ü–∏–∏)
6. [API –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã](#api-–∏-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã)
7. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
8. [Edge cases](#edge-cases)
9. [–ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π](#–ø–ª–∞–Ω-—É–ª—É—á—à–µ–Ω–∏–π)

---

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### Conversation (–î–∏–∞–ª–æ–≥)

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

| –ü–æ–ª–µ Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------|----------------|-------------|----------|
| `display_id` | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –Ω–æ–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞ (#1234). –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ DB trigger, —É–Ω–∏–∫–∞–ª–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö account. |
| `waiting_since` | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –ö–æ–≥–¥–∞ –¥–∏–∞–ª–æ–≥ –Ω–∞—á–∞–ª –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `assignee_assigned_at` ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. |
| `first_reply_created_at` | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –í—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞. |
| `last_activity_at` | ‚ö†Ô∏è –ï—Å—Ç—å `last_message_at` | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ `update_columns` (–Ω–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã). Fallback –Ω–∞ `created_at`. |
| `contact_last_seen_at` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | –ö–æ–≥–¥–∞ –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤–∏–¥–µ–ª –¥–∏–∞–ª–æ–≥. –î–ª—è –ø–æ–∫–∞–∑–∞ "–±—ã–ª(–∞) –Ω–µ–¥–∞–≤–Ω–æ" –≤ –≤–∏–¥–∂–µ—Ç–µ. |
| `agent_last_seen_at` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | –ö–æ–≥–¥–∞ –∞–≥–µ–Ω—Ç (–Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π) –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤–∏–¥–µ–ª –¥–∏–∞–ª–æ–≥. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `assignee_last_read_at`. |
| `snoozed_until` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏. –ü–æ–ª–µ–∑–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤. |
| `identifier` | ‚ùå –ù–µ—Ç | üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã. –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π. |
| `additional_attributes` (JSONB) | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | üü° –í–∞–∂–Ω–æ | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: referer, browser, OS, IP. –£ –Ω–∞—Å –µ—Å—Ç—å `meta` –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö, –Ω–æ –Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ. |
| `custom_attributes` (JSONB) | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏. |
| `cached_label_list` | ‚ùå –ù–µ—Ç | üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ (denormalization). |

#### ‚úÖ –ß—Ç–æ –µ—Å—Ç—å —É –Ω–∞—Å

- `assignee_assigned_at` ‚Äî –≤—Ä–µ–º—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–∞–Ω–∞–ª–æ–≥, –Ω–æ –Ω–µ —Ç–æ –∂–µ —Å–∞–º–æ–µ —á—Ç–æ `waiting_since`)
- `assignee_opened_at` ‚Äî –∫–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä –æ—Ç–∫—Ä—ã–ª –¥–∏–∞–ª–æ–≥
- `assignee_last_read_at` ‚Äî –¥–ª—è –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- `rating_score`, `rating_comment`, `rated_at` ‚Äî –æ—Ü–µ–Ω–∫–∞ –¥–∏–∞–ª–æ–≥–∞ (—É Chatwoot —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

1. **`last_message_at` ‚Üí `last_activity_at`:**
   - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–æ–ª–µ
   - –û–±–Ω–æ–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ `update_columns` –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ (–Ω–µ —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª—ã)
   - Fallback –Ω–∞ `created_at` –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω

2. **–î–æ–±–∞–≤–∏—Ç—å `waiting_since`:**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞
   - –û—á–∏—â–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–≤–µ—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∏–ª–∏ –±–æ—Ç–∞
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è

3. **–î–æ–±–∞–≤–∏—Ç—å `first_reply_created_at`:**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º –æ—Ç–≤–µ—Ç–µ (–Ω–µ –±–æ—Ç, –Ω–µ campaign)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

---

### Message (–°–æ–æ–±—â–µ–Ω–∏–µ)

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

| –ü–æ–ª–µ Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------|----------------|-------------|----------|
| `processed_message_content` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è). –î–ª—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏. |
| `content_attributes` (JSON) | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: `in_reply_to`, `deleted`, `external_created_at`, `translations`. –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π. |
| `external_source_ids` (JSONB) | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | ID –≤–æ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (Slack, Telegram). –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π. |
| `source_id` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | ID –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏ –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Ö. |
| `sentiment` (JSONB) | ‚ùå –ù–µ—Ç | üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | –ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ. |
| `echo_id` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | –í—Ä–µ–º–µ–Ω–Ω—ã–π ID –∏–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏. –î–ª—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π UI. |
| –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞ (–º–æ–¥–µ–ª—å) | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏: –º–∞–∫—Å–∏–º—É–º 20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –¥–∏–∞–ª–æ–≥. |
| –õ–∏–º–∏—Ç –¥–ª–∏–Ω—ã | ‚ö†Ô∏è –ù–µ—Ç —è–≤–Ω–æ–≥–æ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | Chatwoot: –º–∞–∫—Å–∏–º—É–º 150,000 —Å–∏–º–≤–æ–ª–æ–≤. –ù—É–∂–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è. |
| –õ–∏–º–∏—Ç –≤–ª–æ–∂–µ–Ω–∏–π | ‚ö†Ô∏è –ù–µ—Ç —è–≤–Ω–æ–≥–æ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | Chatwoot: –º–∞–∫—Å–∏–º—É–º 15 —Ñ–∞–π–ª–æ–≤. –ù—É–∂–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è. |

#### ‚úÖ –ß—Ç–æ –µ—Å—Ç—å —É –Ω–∞—Å

- `body` ‚Äî —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `delivered_at` ‚Äî –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- `read_at` ‚Äî –ø—Ä–æ—á–∏—Ç–∞–Ω–æ (–¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö)
- `direction` ‚Äî –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (IN, OUT, INTERNAL)
- –í–∞–ª–∏–¥–∞—Ü–∏—è direction/sender –≤ `clean()`

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

1. **–î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ñ–ª—É–¥–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏:**
   ```python
   def clean(self):
       # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª—É–¥–∞: –º–∞–∫—Å–∏–º—É–º 20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –¥–∏–∞–ª–æ–≥
       if self.conversation_id:
           recent_count = Message.objects.filter(
               conversation_id=self.conversation_id,
               created_at__gte=timezone.now() - timedelta(minutes=1)
           ).count()
           if recent_count >= 20:
               raise ValidationError("Too many messages")
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å `content_attributes` (JSONField):**
   - –î–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (`in_reply_to`)
   - –î–ª—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (`deleted`)
   - –î–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (`translations`)
   - –î–ª—è –≤–Ω–µ—à–Ω–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (`external_created_at`)

3. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª–∏–Ω—ã:**
   - –ú–∞–∫—Å–∏–º—É–º 150,000 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è `body`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –º–æ–¥–µ–ª–∏ –∏ serializer

4. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–ª–æ–∂–µ–Ω–∏–π:**
   - –ú–∞–∫—Å–∏–º—É–º 15 —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ `clean()` –∏–ª–∏ —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª

---

### Contact (–ö–æ–Ω—Ç–∞–∫—Ç)

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

| –ü–æ–ª–µ Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------|----------------|-------------|----------|
| `last_activity_at` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–∞. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π. |
| `blocked` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è mute –¥–∏–∞–ª–æ–≥–æ–≤. |
| `contact_type` | ‚ùå –ù–µ—Ç | üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | –¢–∏–ø: visitor, lead, customer. |
| `identifier` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π) | ‚ö†Ô∏è –ï—Å—Ç—å `external_id` | üü° –í–∞–∂–Ω–æ | –£ Chatwoot –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ä–∞–º–∫–∞—Ö account. |
| –í–∞–ª–∏–¥–∞—Ü–∏—è email | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | üü° –í–∞–∂–Ω–æ | Chatwoot: case-insensitive —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å, —Ñ–æ—Ä–º–∞—Ç Devise.email_regexp. |
| –í–∞–ª–∏–¥–∞—Ü–∏—è phone | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | üü° –í–∞–∂–Ω–æ | Chatwoot: —Ñ–æ—Ä–º–∞—Ç E.164 (+1234567890), —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ä–∞–º–∫–∞—Ö account. |

#### ‚úÖ –ß—Ç–æ –µ—Å—Ç—å —É –Ω–∞—Å

- `external_id` ‚Äî –≤–Ω–µ—à–Ω–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `name`, `email`, `phone` ‚Äî –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è
- `region_detected` ‚Äî —Ä–µ–≥–∏–æ–Ω –ø–æ GeoIP

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

1. **–î–æ–±–∞–≤–∏—Ç—å `last_activity_at`:**
   - –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

2. **–î–æ–±–∞–≤–∏—Ç—å `blocked`:**
   - –î–ª—è mute –¥–∏–∞–ª–æ–≥–æ–≤
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

3. **–£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
   - Email: case-insensitive —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ä–∞–º–∫–∞—Ö account
   - Phone: —Ñ–æ—Ä–º–∞—Ç E.164, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ä–∞–º–∫–∞—Ö account
   - Identifier: —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ä–∞–º–∫–∞—Ö account

---

### ContactInbox (–°–≤—è–∑—å –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å inbox)

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–±–µ–ª

| –ü–æ–ª–µ Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------|----------------|-------------|----------|
| `ContactInbox` –º–æ–¥–µ–ª—å | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –°–≤—è–∑—å –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º inbox. –û–¥–∏–Ω –∫–æ–Ω—Ç–∞–∫—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö inbox. –•—Ä–∞–Ω–∏—Ç `source_id` –∏ `pubsub_token`. |

**–ü—Ä–æ–±–ª–µ–º–∞:** –£ –Ω–∞—Å –∫–æ–Ω—Ç–∞–∫—Ç –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ inbox –Ω–∞–ø—Ä—è–º—É—é. –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–±–ª–µ–º—ã:
- –ù–µ—Ç `source_id` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ —Ä–∞–º–∫–∞—Ö inbox
- –ù–µ—Ç `pubsub_token` –¥–ª—è WebSocket (–∏—Å–ø–æ–ª—å–∑—É–µ–º widget_session_token)
- –°–ª–æ–∂–Ω–µ–µ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `ContactInbox`:**
   ```python
   class ContactInbox(models.Model):
       contact = models.ForeignKey(Contact, on_delete=models.CASCADE)
       inbox = models.ForeignKey(Inbox, on_delete=models.CASCADE)
       source_id = models.TextField()  # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤ —Ä–∞–º–∫–∞—Ö inbox
       pubsub_token = models.CharField(max_length=64, unique=True)
       
       class Meta:
           unique_together = [('inbox', 'source_id')]
   ```

2. **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - –°–æ–∑–¥–∞—Ç—å ContactInbox –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤
   - `source_id` = `contact.external_id` –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π

---

## –ò–Ω–¥–µ–∫—Å—ã –ë–î

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

#### Conversation

| –ò–Ω–¥–µ–∫—Å Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|-----------------|----------------|-------------|
| `(account_id, inbox_id, status, assignee_id)` | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| `(account_id, display_id)` UNIQUE | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è display_id) |
| `(status, account_id)` | ‚ö†Ô∏è –ï—Å—Ç—å `(branch, status)` | üü° –í–∞–∂–Ω–æ |
| `(status, priority)` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ |
| `(waiting_since)` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ (–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è) |
| `(first_reply_created_at)` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ (–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è) |

#### Message

| –ò–Ω–¥–µ–∫—Å Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|-----------------|----------------|-------------|
| `(conversation_id, account_id, message_type, created_at)` | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| `(account_id, content_type, created_at)` | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ |
| GIN –∏–Ω–¥–µ–∫—Å –Ω–∞ `content` | ‚ùå –ù–µ—Ç | üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞) |

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤:**
   ```python
   # –í –º–∏–≥—Ä–∞—Ü–∏–∏:
   migrations.AddIndex(
       model_name='conversation',
       index=models.Index(
           fields=['inbox', 'status', 'assignee'],
           name='messenger_conv_inbox_status_assignee_idx'
       ),
   )
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π:**
   ```python
   migrations.AddIndex(
       model_name='message',
       index=models.Index(
           fields=['conversation', 'direction', 'created_at'],
           name='messenger_msg_conv_dir_created_idx'
       ),
   )
   ```

---

## –°–µ—Ä–≤–∏—Å—ã –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### Auto Assignment (–ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ)

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

| –§—É–Ω–∫—Ü–∏—è Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|------------------|----------------|-------------|
| Round-Robin —á–µ—Ä–µ–∑ Redis —Å–ø–∏—Å–æ–∫ | ‚ö†Ô∏è –ß–µ—Ä–µ–∑ cache –∏–Ω–¥–µ–∫—Å | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏ | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Rate Limiter –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ |
| Capacity –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ (open_count) | üü° –í–∞–∂–Ω–æ |

#### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```python
# backend/messenger/services.py
def auto_assign_conversation(conversation: Conversation) -> Optional[User]:
    # –ö–∞–Ω–¥–∏–¥–∞—Ç—ã —Å —É—á—ë—Ç–æ–º –Ω–∞–≥—Ä—É–∑–∫–∏
    candidates_qs = User.objects.filter(...).annotate(
        open_count=Count("assigned_conversations", ...)
    ).order_by("open_count", "id")
    
    # Round-robin —á–µ—Ä–µ–∑ cache –∏–Ω–¥–µ–∫—Å (–ù–ï —Å–ø–∏—Å–æ–∫!)
    cache_key = f"messenger:rr:{branch_id}:{inbox_id}"
    idx = cache.get(cache_key, 0)
    idx = int(idx) % len(candidates)
    cache.set(cache_key, (idx + 1) % len(candidates), timeout=RR_CACHE_TTL)
```

#### –ü—Ä–æ–±–ª–µ–º—ã

1. **Round-Robin —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å, –∞ –Ω–µ —Å–ø–∏—Å–æ–∫:**
   - Chatwoot —Ö—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –≤ Redis (`LPUSH`, `LPOP`)
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–∞–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –æ—á–µ—Ä–µ–¥—å –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
   - –£ –Ω–∞—Å –∏–Ω–¥–µ–∫—Å –º–æ–∂–µ—Ç "—Å—ä–µ—Ö–∞—Ç—å" –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

2. **–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—á–µ—Ä–µ–¥–∏:**
   - Chatwoot –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ—á–µ—Ä–µ–¥—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—É—â–∏–º —á–ª–µ–Ω–∞–º inbox
   - –ï—Å–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç

3. **–ù–µ—Ç Rate Limiter:**
   - Chatwoot –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É –æ–¥–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å (–ø–æ –æ–±—Ä–∞–∑—Ü—É Chatwoot)

1. **–ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å Round-Robin –Ω–∞ Redis —Å–ø–∏—Å–æ–∫:**
   ```python
   # –•—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ ID –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –≤ Redis
   # –ö–ª—é—á: "messenger:rr:queue:{inbox_id}"
   # –ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏: LPOP –∏–∑ –Ω–∞—á–∞–ª–∞, LPUSH –≤ –∫–æ–Ω–µ—Ü
   # –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–∞–≤–∞: –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ—á–µ—Ä–µ–¥–∏:**
   ```python
   def validate_queue(inbox_id):
       current_members = list(inbox.members.values_list('id', flat=True))
       queue = redis.lrange(f"messenger:rr:queue:{inbox_id}")
       if sorted(current_members) != sorted([int(x) for x in queue]):
           # –û—á–µ—Ä–µ–¥—å –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
           reset_queue(inbox_id, current_members)
   ```

3. **–î–æ–±–∞–≤–∏—Ç—å Rate Limiter:**
   ```python
   class AssignmentRateLimiter:
       def within_limit?(agent, inbox):
           # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –∑–∞ –æ–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏
           # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AssignmentPolicy
   ```

---

### Waiting Since –ª–æ–≥–∏–∫–∞

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–±–µ–ª

**Chatwoot:**
- `waiting_since` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- –û—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–≤–µ—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∏–ª–∏ –±–æ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è
- –û—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–∑–æ–ª–≤–µ –¥–∏–∞–ª–æ–≥–∞

**–ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä:**
- –ù–µ—Ç `waiting_since`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `assignee_assigned_at`, –Ω–æ —ç—Ç–æ –Ω–µ —Ç–æ –∂–µ —Å–∞–º–æ–µ

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `waiting_since`:**
   ```python
   waiting_since = models.DateTimeField(
       "–ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞",
       null=True,
       blank=True,
       db_index=True,
   )
   ```

2. **–õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø–æ –æ–±—Ä–∞–∑—Ü—É Chatwoot):**
   ```python
   # –í Message model –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è:
   def update_waiting_since(self):
       if self.direction == Message.Direction.IN:
           # –í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º waiting_since –µ—Å–ª–∏ –ø—É—Å—Ç–æ
           if not self.conversation.waiting_since:
               self.conversation.update(waiting_since=self.created_at)
       elif self.direction == Message.Direction.OUT:
           # –ò—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –æ—á–∏—â–∞–µ–º waiting_since
           if self.conversation.waiting_since:
               self.conversation.update(waiting_since=None)
   ```

---

### First Reply Created At

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–±–µ–ª

**Chatwoot:**
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º –æ—Ç–≤–µ—Ç–µ (–Ω–µ –±–æ—Ç, –Ω–µ campaign)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- –û—á–∏—â–∞–µ—Ç `waiting_since` –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

**–ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä:**
- –ù–µ—Ç –ø–æ–ª—è
- –ù–µ—Ç –ª–æ–≥–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ:**
   ```python
   first_reply_created_at = models.DateTimeField(
       "–í—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞",
       null=True,
       blank=True,
       db_index=True,
   )
   ```

2. **–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (–ø–æ –æ–±—Ä–∞–∑—Ü—É Chatwoot):**
   ```python
   def is_valid_first_reply(message):
       # –ü—Ä–æ–≤–µ—Ä–∫–∏:
       # 1. –ò—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (OUT)
       # 2. –ù–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ
       # 3. –û—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ –±–æ—Ç)
       # 4. –ù–µ—Ç automation_rule_id –≤ content_attributes
       # 5. –ù–µ—Ç campaign_id –≤ additional_attributes
       # 6. –£ –¥–∏–∞–ª–æ–≥–∞ –µ—â—ë –Ω–µ—Ç first_reply_created_at
       # 7. –£ –¥–∏–∞–ª–æ–≥–∞ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   ```

---

## Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|---------------------|----------------|-------------|
| ActionCable (WebSocket) | ‚ö†Ô∏è SSE –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ | üü° –í–∞–∂–Ω–æ |
| Event Dispatcher | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Pubsub Token | ‚ö†Ô∏è widget_session_token | üü° –í–∞–∂–Ω–æ |
| OnlineStatusTracker | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ |

#### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

- **–í–∏–¥–∂–µ—Ç:** SSE —á–µ—Ä–µ–∑ `/api/widget/stream/`
- **–û–ø–µ—Ä–∞—Ç–æ—Ä—Å–∫–∞—è –ø–∞–Ω–µ–ª—å:** –ù–µ—Ç real-time (—Ç–æ–ª—å–∫–æ polling –∏–ª–∏ —Ä—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

#### –ü—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ—Ç Event Dispatcher:**
   - Chatwoot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Å–æ–±—ã—Ç–∏–π
   - –°–æ–±—ã—Ç–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, webhooks, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - –£ –Ω–∞—Å —Å–æ–±—ã—Ç–∏—è —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –∫–æ–¥—É

2. **–ù–µ—Ç OnlineStatusTracker:**
   - Chatwoot —Ö—Ä–∞–Ω–∏—Ç —Å—Ç–∞—Ç—É—Å—ã –æ–Ω–ª–∞–π–Ω –≤ Redis
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏/–æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ WebSocket
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã)

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–ø–æ –æ–±—Ä–∞–∑—Ü—É Chatwoot)

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Event Dispatcher:**
   ```python
   class EventDispatcher:
       def dispatch(event_name, timestamp, data):
           # –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
           # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (—á–µ—Ä–µ–∑ Celery)
           # –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ SSE/WebSocket
           # –û—Ç–ø—Ä–∞–≤–∫–∞ webhooks
   ```

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å OnlineStatusTracker:**
   ```python
   class OnlineStatusTracker:
       @staticmethod
       def update_presence(account_id, user_class, user_id):
           # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Redis: "online_status:{account_id}:{user_id}" = "online"
       
       @staticmethod
       def get_available_users(account_id):
           # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Redis
   ```

3. **–†–∞—Å—à–∏—Ä–∏—Ç—å SSE –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏:**
   - –°–æ–∑–¥–∞—Ç—å `/api/messenger/stream/` –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
   - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

| –ó–∞—â–∏—Ç–∞ Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|-----------------|----------------|-------------|
| –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞ (–º–æ–¥–µ–ª—å) | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π | ‚ö†Ô∏è –ù–µ—Ç —è–≤–Ω–æ–π | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| –õ–∏–º–∏—Ç –≤–ª–æ–∂–µ–Ω–∏–π | ‚ö†Ô∏è –ù–µ—Ç —è–≤–Ω–æ–≥–æ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| JSONB –≤–∞–ª–∏–¥–∞—Ü–∏–∏ | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ |
| Rate limiting (API) | ‚úÖ –ï—Å—Ç—å | ‚úÖ OK |

#### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

- **Rate Limiting:** –ï—Å—Ç—å —á–µ—Ä–µ–∑ `WidgetBootstrapThrottle`, `WidgetSendThrottle`, `WidgetPollThrottle`
- **–ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞:** –ù–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã:** –ù–µ—Ç —è–≤–Ω–æ–π (—Ç–æ–ª—å–∫–æ –≤ serializer –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞: 2000 —Å–∏–º–≤–æ–ª–æ–≤)

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–ø–æ –æ–±—Ä–∞–∑—Ü—É Chatwoot)

1. **–î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ñ–ª—É–¥–∞ –≤ –º–æ–¥–µ–ª—å Message:**
   ```python
   def clean(self):
       # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ...
       
       # –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞ (–ø–æ –æ–±—Ä–∞–∑—Ü—É Chatwoot)
       if self.conversation_id:
           recent_count = Message.objects.filter(
               conversation_id=self.conversation_id,
               created_at__gte=timezone.now() - timedelta(minutes=1)
           ).count()
           if recent_count >= 20:  # CONVERSATION_MESSAGE_PER_MINUTE_LIMIT
               raise ValidationError("Too many messages")
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª–∏–Ω—ã:**
   ```python
   class Message(models.Model):
       body = models.TextField(
           "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
           blank=True,
           default="",
           validators=[MaxLengthValidator(150000)]  # –ö–∞–∫ –≤ Chatwoot
       )
   ```

3. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–ª–æ–∂–µ–Ω–∏–π:**
   ```python
   NUMBER_OF_PERMITTED_ATTACHMENTS = 15
   
   def clean(self):
       if self.attachments.count() >= NUMBER_OF_PERMITTED_ATTACHMENTS:
           raise ValidationError("Too many attachments")
   ```

4. **–î–æ–±–∞–≤–∏—Ç—å JSONB –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
   ```python
   # –í–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è JSONB –ø–æ–ª–µ–π
   def validate_jsonb_attributes(value):
       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (< 1500)
       # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (< 9999999999)
   ```

---

## API –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

| –§—É–Ω–∫—Ü–∏—è Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|------------------|----------------|-------------|
| Throttling last_seen | ‚ùå –ù–µ—Ç | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Update last_seen API | ‚ö†Ô∏è –ï—Å—Ç—å `/read/` | üü° –í–∞–∂–Ω–æ |
| Typing status API | ‚úÖ –ï—Å—Ç—å | ‚úÖ OK |
| Attachments API | ‚úÖ –ï—Å—Ç—å | ‚úÖ OK |

#### –ü—Ä–æ–±–ª–µ–º–∞: Throttling last_seen

**Chatwoot:**
```ruby
def update_last_seen
  # –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
  return update_last_seen_on_conversation(now, true) if 
    assignee? && conversation.assignee_unread_messages.any?
  
  # Throttling: –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ > 1 —á–∞—Å–∞
  return unless should_update_last_seen?
  update_last_seen_on_conversation(now, assignee?)
end

def should_update_last_seen?
  agent_needs_update = conversation.agent_last_seen_at.blank? || 
    conversation.agent_last_seen_at < 1.hour.ago
  # ...
end
```

**–ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä:**
- –ù–µ—Ç throttling
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–î–æ–±–∞–≤–∏—Ç—å throttling –¥–ª—è `assignee_last_read_at`:**
   ```python
   @action(detail=True, methods=["post"], url_path="read")
   def read(self, request, pk=None):
       conversation = self.get_object()
       
       # –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ–º –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
       unread_count = conversation.messages.filter(
           direction=Message.Direction.IN,
           created_at__gt=F('assignee_last_read_at') or datetime.min
       ).count()
       
       if unread_count > 0:
           # –ï—Å—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–∞–∑—É
           conversation.update(assignee_last_read_at=timezone.now())
       else:
           # Throttling: –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ > 1 —á–∞—Å–∞
           if not conversation.assignee_last_read_at or \
              conversation.assignee_last_read_at < timezone.now() - timedelta(hours=1):
               conversation.update(assignee_last_read_at=timezone.now())
       
       return Response({"status": "ok"})
   ```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

1. **–ù–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤** (—Å–º. —Ä–∞–∑–¥–µ–ª "–ò–Ω–¥–µ–∫—Å—ã –ë–î")
2. **–ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:**
   - Chatwoot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `includes` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è N+1
   - –£ –Ω–∞—Å —á–∞—Å—Ç–∏—á–Ω–æ –µ—Å—Ç—å `select_related`, –Ω–æ –Ω–µ –≤–µ–∑–¥–µ

3. **–ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - Chatwoot –∫—ç—à–∏—Ä—É–µ—Ç round-robin –æ—á–µ—Ä–µ–¥—å, online status, typing status
   - –£ –Ω–∞—Å –µ—Å—Ç—å –∫—ç—à –¥–ª—è round-robin, –Ω–æ –Ω–µ –¥–ª—è online status

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** (—Å–º. —Ä–∞–∑–¥–µ–ª "–ò–Ω–¥–µ–∫—Å—ã –ë–î")
2. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã:**
   ```python
   # –í ConversationViewSet:
   qs = selectors.visible_conversations_qs(user).select_related(
       "contact", "branch", "region", "assignee", "inbox"
   ).prefetch_related("messages")
   ```

3. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ online status:**
   ```python
   # –•—Ä–∞–Ω–∏—Ç—å –≤ Redis: "online_status:{user_id}" = "online"/"offline"
   # –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
   ```

---

## Edge cases

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã

| Edge case Chatwoot | –ù–∞—à –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|---------------------|----------------|-------------|
| Race condition –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ source_id | ‚ùå –ù–µ—Ç | üü° –í–∞–∂–Ω–æ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–Ω–µ—à–Ω–∏—Ö API | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | üü° –í–∞–∂–Ω–æ |
| WebSocket fallback –Ω–∞ polling | ‚úÖ –ï—Å—Ç—å –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ | ‚úÖ OK |

#### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–ó–∞—â–∏—Ç–∞ –æ—Ç race condition:**
   ```python
   # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å select_for_update –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏
   with transaction.atomic():
       conversation = Conversation.objects.select_for_update().get(pk=conversation_id)
       if conversation.assignee_id is None:
           conversation.assignee_id = user_id
           conversation.save()
   ```

2. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ source_id:**
   ```python
   # –í Message model:
   source_id = models.TextField(
       "ID –∏—Å—Ç–æ—á–Ω–∏–∫–∞",
       blank=True,
       null=True,
       db_index=True,
       help_text="–î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Ö"
   )
   
   # –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å source_id
   if source_id:
       existing = Message.objects.filter(
           conversation=conversation,
           source_id=source_id
       ).first()
       if existing:
           return existing  # –î—É–±–ª–∏–∫–∞—Ç
   ```

---

## –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π (1-2 –Ω–µ–¥–µ–ª–∏)

#### 1.1. Conversation –º–æ–¥–µ–ª—å

- [ ] –î–æ–±–∞–≤–∏—Ç—å `display_id` —á–µ—Ä–µ–∑ DB trigger (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `waiting_since` (DateTimeField, db_index=True)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `first_reply_created_at` (DateTimeField, db_index=True)
- [ ] –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `last_message_at` ‚Üí `last_activity_at`
- [ ] –î–æ–±–∞–≤–∏—Ç—å `contact_last_seen_at` (DateTimeField)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `agent_last_seen_at` (DateTimeField)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `snoozed_until` (DateTimeField, nullable)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `identifier` (CharField, nullable)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `additional_attributes` (JSONField)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `custom_attributes` (JSONField)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–∑–∞–ø–æ–ª–Ω–∏—Ç—å `last_activity_at` –∏–∑ `last_message_at`)

#### 1.2. Message –º–æ–¥–µ–ª—å

- [ ] –î–æ–±–∞–≤–∏—Ç—å `processed_message_content` (TextField)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `content_attributes` (JSONField)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `external_source_ids` (JSONField)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `source_id` (TextField, db_index=True)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `echo_id` (CharField, –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª–∏–Ω—ã (–º–∞–∫—Å–∏–º—É–º 150,000 —Å–∏–º–≤–æ–ª–æ–≤)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ñ–ª—É–¥–∞ –≤ `clean()` (20 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–ª–æ–∂–µ–Ω–∏–π (–º–∞–∫—Å–∏–º—É–º 15 —Ñ–∞–π–ª–æ–≤)
- [ ] –û–±–Ω–æ–≤–ª—è—Ç—å `last_activity_at` –¥–∏–∞–ª–æ–≥–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

#### 1.3. Contact –º–æ–¥–µ–ª—å

- [ ] –î–æ–±–∞–≤–∏—Ç—å `last_activity_at` (DateTimeField, db_index=True)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `blocked` (BooleanField, default=False)
- [ ] –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (email case-insensitive, phone E.164)
- [ ] –°–¥–µ–ª–∞—Ç—å `external_id` —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –≤ —Ä–∞–º–∫–∞—Ö account (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å)

#### 1.4. ContactInbox –º–æ–¥–µ–ª—å (–Ω–æ–≤–∞—è)

- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `ContactInbox`
- [ ] –ü–æ–ª—è: `contact`, `inbox`, `source_id`, `pubsub_token`
- [ ] –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: `(inbox, source_id)`
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞—Ç—å ContactInbox –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤)

---

### –§–∞–∑–∞ 2: –ò–Ω–¥–µ–∫—Å—ã –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (3-5 –¥–Ω–µ–π)

#### 2.1. –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

- [ ] `(inbox_id, status, assignee_id)` –¥–ª—è Conversation
- [ ] `(conversation_id, direction, created_at)` –¥–ª—è Message
- [ ] `(status, priority)` –¥–ª—è Conversation
- [ ] `(waiting_since)` –¥–ª—è Conversation
- [ ] `(first_reply_created_at)` –¥–ª—è Conversation
- [ ] `(account_id, display_id)` UNIQUE –¥–ª—è Conversation (–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è display_id)

#### 2.2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

- [ ] –î–æ–±–∞–≤–∏—Ç—å `select_related` –∏ `prefetch_related` –≤–æ –≤—Å–µ ViewSet
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å–æ–æ–±—â–µ–Ω–∏–π

---

### –§–∞–∑–∞ 3: –°–µ—Ä–≤–∏—Å—ã –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (1-2 –Ω–µ–¥–µ–ª–∏)

#### 3.1. Round-Robin —á–µ—Ä–µ–∑ Redis —Å–ø–∏—Å–æ–∫

- [ ] –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å `auto_assign_conversation` –Ω–∞ Redis —Å–ø–∏—Å–æ–∫
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `InboxRoundRobinService` (–ø–æ –æ–±—Ä–∞–∑—Ü—É Chatwoot)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ—á–µ—Ä–µ–¥–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã: `add_agent_to_queue`, `remove_agent_from_queue`, `reset_queue`

#### 3.2. Rate Limiter –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π

- [ ] –°–æ–∑–¥–∞—Ç—å `AssignmentRateLimiter` (–ø–æ –æ–±—Ä–∞–∑—Ü—É Chatwoot)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `auto_assign_conversation`
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `AssignmentPolicy` (–Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å –∏–ª–∏ settings)

#### 3.3. Waiting Since –ª–æ–≥–∏–∫–∞

- [ ] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `waiting_since` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- [ ] –û—á–∏—â–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–≤–µ—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞/–±–æ—Ç–∞
- [ ] –û—á–∏—â–∞—Ç—å –ø—Ä–∏ —Ä–µ–∑–æ–ª–≤–µ –¥–∏–∞–ª–æ–≥–∞
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è

#### 3.4. First Reply Created At –ª–æ–≥–∏–∫–∞

- [ ] –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç (–Ω–µ –±–æ—Ç, –Ω–µ campaign)
- [ ] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `first_reply_created_at`
- [ ] –û—á–∏—â–∞—Ç—å `waiting_since` –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

---

### –§–∞–∑–∞ 4: Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)

#### 4.1. Event Dispatcher

- [ ] –°–æ–∑–¥–∞—Ç—å `EventDispatcher` (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–æ–±—ã—Ç–∏—è (CONVERSATION_CREATED, MESSAGE_CREATED, etc.)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å listeners –¥–ª—è SSE/WebSocket
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å listeners –¥–ª—è webhooks
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –º–æ–¥–µ–ª–∏ (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

#### 4.2. OnlineStatusTracker

- [ ] –°–æ–∑–¥–∞—Ç—å `OnlineStatusTracker`
- [ ] –•—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã –≤ Redis
- [ ] –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã)

#### 4.3. SSE –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏

- [ ] –°–æ–∑–¥–∞—Ç—å `/api/messenger/stream/` endpoint
- [ ] –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–∏–∞–ª–æ–≥–µ

---

### –§–∞–∑–∞ 5: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (3-5 –¥–Ω–µ–π)

#### 5.1. –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞

- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ –º–æ–¥–µ–ª—å Message (20 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª–∏–Ω—ã (150,000 —Å–∏–º–≤–æ–ª–æ–≤)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–ª–æ–∂–µ–Ω–∏–π (15 —Ñ–∞–π–ª–æ–≤)

#### 5.2. JSONB –≤–∞–ª–∏–¥–∞—Ü–∏–∏

- [ ] –°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è JSONB –ø–æ–ª–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (< 1500)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (< 9999999999)

#### 5.3. Throttling last_seen

- [ ] –î–æ–±–∞–≤–∏—Ç—å throttling –≤ `/read/` endpoint
- [ ] –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –∏–ª–∏ –ø—Ä–æ—à–ª–æ > 1 —á–∞—Å–∞

---

### –§–∞–∑–∞ 6: Edge cases –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å (3-5 –¥–Ω–µ–π)

#### 6.1. Race conditions

- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `select_for_update` –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- [ ] –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

#### 6.2. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è

- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `source_id` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### 6.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–Ω–µ—à–Ω–∏—Ö API
- [ ] Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (–¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å)

1. **–ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏
2. **–°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** ‚Äî –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **Waiting Since –∏ First Reply** ‚Äî –¥–ª—è –º–µ—Ç—Ä–∏–∫
4. **Round-Robin —á–µ—Ä–µ–∑ Redis —Å–ø–∏—Å–æ–∫** ‚Äî –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
5. **Throttling last_seen** ‚Äî –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üü° –í–∞–∂–Ω–æ (–¥–µ–ª–∞—Ç—å –≤–æ –≤—Ç–æ—Ä—É—é –æ—á–µ—Ä–µ–¥—å)

6. **Display ID** ‚Äî –¥–ª—è UX –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
7. **Event Dispatcher** ‚Äî –¥–ª—è —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏
8. **OnlineStatusTracker** ‚Äî –¥–ª—è –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
9. **Content Attributes** ‚Äî –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
10. **ContactInbox** ‚Äî –¥–ª—è –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç–∏

### üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å)

11. **Snoozed Until** ‚Äî –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏
12. **Sentiment** ‚Äî –∞–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
13. **GIN –∏–Ω–¥–µ–∫—Å –Ω–∞ content** ‚Äî –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

---

## –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

- **–§–∞–∑–∞ 1:** 1-2 –Ω–µ–¥–µ–ª–∏ (–º–æ–¥–µ–ª–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏)
- **–§–∞–∑–∞ 2:** 3-5 –¥–Ω–µ–π (–∏–Ω–¥–µ–∫—Å—ã)
- **–§–∞–∑–∞ 3:** 1-2 –Ω–µ–¥–µ–ª–∏ (—Å–µ—Ä–≤–∏—Å—ã)
- **–§–∞–∑–∞ 4:** 1-2 –Ω–µ–¥–µ–ª–∏ (real-time)
- **–§–∞–∑–∞ 5:** 3-5 –¥–Ω–µ–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- **–§–∞–∑–∞ 6:** 3-5 –¥–Ω–µ–π (edge cases)

**–ò—Ç–æ–≥–æ:** ~5-7 –Ω–µ–¥–µ–ª—å –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ–≤–µ–¥–µ–Ω–∏—è –¥–æ production-ready —Å–æ—Å—Ç–æ—è–Ω–∏—è.

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å–∫–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è Chatwoot –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞.*
